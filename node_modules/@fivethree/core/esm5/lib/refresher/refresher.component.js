/**
 * @fileoverview added by tsickle
 * Generated from: lib/refresher/refresher.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { takeUntil, tap, filter, map } from 'rxjs/operators';
import { FivPull } from './../pull/pull.directive';
import { FivRefresherContent } from './refresher-content/refresher-content.component';
import { Component, Output, EventEmitter, ViewChild, ElementRef, Input, Renderer2 } from '@angular/core';
import { animate, style, transition, trigger, AnimationBuilder } from '@angular/animations';
import { Platform } from '@ionic/angular';
import { Subject } from 'rxjs';
import { easeOutSine, tween, reverse } from '@fivethree/ngx-rxjs-animations';
var FivRefresher = /** @class */ (function () {
    function FivRefresher(builder, refresher, renderer, platform) {
        this.builder = builder;
        this.refresher = refresher;
        this.renderer = renderer;
        this.platform = platform;
        this.hintText = 'new posts';
        this.maxPullHeight = 168;
        this.minPullHeight = 112;
        this.fivProgressChanged = new EventEmitter();
        this.fivRefresh = new EventEmitter();
        this.hintVisible = false;
        this.currentProgress = 0;
        this.refreshing = false;
        this.$onDestroy = new Subject();
    }
    /**
     * @return {?}
     */
    FivRefresher.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.attachPullDirective()];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.$onDestroy.next();
    };
    /**
     * @private
     * @return {?}
     */
    FivRefresher.prototype.attachPullDirective = /**
     * @private
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var content, scroll, pull;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        content = this.refresher.nativeElement.closest('ion-content');
                        if (!content) {
                            throw new Error('The fiv-refresher component needs to be inside of an ion-content.');
                        }
                        content.scrollEvents = true;
                        return [4 /*yield*/, content.getScrollElement()];
                    case 1:
                        scroll = _a.sent();
                        pull = new FivPull(new ElementRef(content), this.platform, content);
                        pull.init();
                        pull.fivPull
                            .pipe(filter((/**
                         * @return {?}
                         */
                        function () { return !_this.refreshing && !_this.hintVisible; })), tap((/**
                         * @param {?} progress
                         * @return {?}
                         */
                        function (progress) { return _this.fivPull(progress); })), takeUntil(this.$onDestroy))
                            .subscribe();
                        pull.fivRefresh
                            .pipe(tap((/**
                         * @return {?}
                         */
                        function () { return _this.refresh(); })), takeUntil(this.$onDestroy))
                            .subscribe();
                        pull.fivCancel
                            .pipe(tap((/**
                         * @return {?}
                         */
                        function () { return _this.moveBack(); })), takeUntil(this.$onDestroy))
                            .subscribe();
                        this.spinner.fivComplete.pipe(takeUntil(this.$onDestroy)).subscribe();
                        this.fivRefresh
                            .pipe(tap((/**
                         * @return {?}
                         */
                        function () { return scroll.scrollTo({ top: 0, behavior: 'smooth' }); })), takeUntil(this.$onDestroy))
                            .subscribe();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.refresh = /**
     * @return {?}
     */
    function () {
        if (this.refreshing) {
            return;
        }
        this.refreshing = true;
        this.spinner.load();
        this.setPullAnimationProgress(112 / 168);
        this.fivRefresh.emit(this);
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.complete = /**
     * @return {?}
     */
    function () {
        if (!this.refreshing) {
            return;
        }
        this.spinner.complete();
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.onDone = /**
     * @return {?}
     */
    function () {
        this.spinner.hide();
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.onHidden = /**
     * @return {?}
     */
    function () {
        this.refreshing = false;
        this.setPullAnimationProgress(0);
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.showHint = /**
     * @return {?}
     */
    function () {
        this.hintVisible = true;
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.onHintClicked = /**
     * @return {?}
     */
    function () {
        this.hintVisible = false;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FivRefresher.prototype.postHint = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!event.fromState && event.toState === 'void') {
            this.refresh();
        }
    };
    /**
     * @param {?} progress
     * @return {?}
     */
    FivRefresher.prototype.setPullAnimationProgress = /**
     * @param {?} progress
     * @return {?}
     */
    function (progress) {
        this.currentProgress = progress;
        if (progress < 1) {
            this.renderer.setStyle(this.spinner.element.nativeElement, 'transform', "translateY(" + this.minPullHeight * progress + "px)");
        }
    };
    /**
     * @param {?} progress
     * @return {?}
     */
    FivRefresher.prototype.changeAnimationToProgress = /**
     * @param {?} progress
     * @return {?}
     */
    function (progress) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            /** @type {?} */
            var animation = _this.builder.build([
                style({
                    transform: "translateY(" + 100 *
                        _this.currentProgress + "px) rotateZ(" + 360 * _this.currentProgress + "deg)"
                }),
                animate('85ms ease-in', style({
                    transform: "translateY(" + 100 * progress + "px) rotateZ(" + 360 *
                        progress + "deg)"
                }))
            ]);
            /** @type {?} */
            var player = animation.create(_this.spinner.element.nativeElement);
            player.play();
            player.onDone((/**
             * @return {?}
             */
            function () {
                _this.setPullAnimationProgress(progress);
                player.destroy();
                resolve();
            }));
        }));
    };
    /**
     * @param {?} progress
     * @return {?}
     */
    FivRefresher.prototype.fivPull = /**
     * @param {?} progress
     * @return {?}
     */
    function (progress) {
        this.setPullAnimationProgress(progress);
        this.spinner.show();
        /** @type {?} */
        var value = Math.max(0, Math.min(100, (progress * 100 * this.maxPullHeight) / this.minPullHeight));
        this.spinner.setValue(value * 0.84);
    };
    /**
     * @return {?}
     */
    FivRefresher.prototype.moveBack = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var animation = this.builder.build([
            style({
                transform: "translateY(" + this.currentProgress *
                    this.minPullHeight + "px) rotateZ(" + 360 * this.currentProgress + "deg)"
            }),
            animate('205ms ease-in', style({ transform: 'translateY(0) rotateZ(0)' }))
        ]);
        /** @type {?} */
        var player = animation.create(this.spinner.element.nativeElement);
        tween(easeOutSine, 145)
            .pipe(reverse(), map((/**
         * @param {?} n
         * @return {?}
         */
        function (n) {
            return Math.max(0, Math.min(100, (_this.currentProgress * n * 100 * _this.maxPullHeight) /
                _this.minPullHeight));
        })), tap((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return _this.spinner.setValue(value); })))
            .subscribe();
        player.play();
        player.onDone((/**
         * @return {?}
         */
        function () {
            _this.setPullAnimationProgress(0);
            _this.spinner.visible = false;
            player.destroy();
        }));
    };
    /**
     * @param {?} progress
     * @return {?}
     */
    FivRefresher.prototype.onSpinnerProgress = /**
     * @param {?} progress
     * @return {?}
     */
    function (progress) {
        this.fivProgressChanged.emit(progress);
        this.renderer
            // tslint:disable-next-line:max-line-length
            .setStyle(this.spinner.element.nativeElement, 'transform', "translateY(" + this.maxPullHeight *
            this.currentProgress + "px) rotateZ(" + (360 * progress) / 200 + "deg)");
    };
    FivRefresher.decorators = [
        { type: Component, args: [{
                    selector: 'fiv-refresher',
                    template: "<fiv-refresher-content [progress]=\"currentProgress\" (fivProgress)=\"onSpinnerProgress($event)\" (fivComplete)=\"onDone()\"\n  (fivHidden)=\"onHidden()\" #spinner>\n</fiv-refresher-content>\n\n<ion-chip class=\"gg-hint-wrapper\" *ngIf=\"hintVisible\" [@hintAnim] (@hintAnim.done)=\"postHint($event)\"\n  (click)=\"onHintClicked()\" #hint>\n  <ion-icon class=\"icon\" name=\"arrow-up\"></ion-icon>\n  <ion-label [ngClass]=\"{'hidden': !hintVisible}\" class=\"text\">{{hintText}}</ion-label>\n</ion-chip>",
                    animations: [
                        trigger('hintAnim', [
                            transition('void => *', [
                                style({ transform: 'translateY(0px) translateX(-50%)' }),
                                animate('150ms ease-in', style({
                                    opacity: 1,
                                    transform: 'translateY(72px) translateX(-50%)'
                                }))
                            ]),
                            transition('* => void', [
                                style({
                                    width: '*',
                                    opacity: 1,
                                    transform: 'translateY(72px) translateX(-50%)'
                                }),
                                animate('150ms 125ms ease-out', style({
                                    width: '40px',
                                    transform: 'translateY(72px) translateX(-50%)'
                                }))
                            ])
                        ])
                    ],
                    styles: [":host{--fiv-spin-color:var(--ion-color-primary);--fiv-hint-color:var(--fiv-spin-color, var(--ion-color-primary));--fiv-spin-background:var(--ion-color-light)}.icon{height:20px;width:20px;background:0 0;color:var(--fiv-hint-color)}.text{font-size:1em;color:var(--fiv-hint-color)}.text.hidden{opacity:0}.gg-hint-wrapper{position:absolute;z-index:8;opacity:1;left:50%;top:-40px;transform:translateY(72px) translateX(-50%);height:40px;padding-left:8px;padding-right:8px;background:var(--fiv-spin-background);border-radius:40px;box-shadow:0 4px 6px 0 rgba(0,0,0,.14),0 4px 5px rgba(0,0,0,.1);margin:0}"]
                }] }
    ];
    /** @nocollapse */
    FivRefresher.ctorParameters = function () { return [
        { type: AnimationBuilder },
        { type: ElementRef },
        { type: Renderer2 },
        { type: Platform }
    ]; };
    FivRefresher.propDecorators = {
        hintText: [{ type: Input }],
        maxPullHeight: [{ type: Input }],
        minPullHeight: [{ type: Input }],
        fivProgressChanged: [{ type: Output }],
        fivRefresh: [{ type: Output }],
        spinner: [{ type: ViewChild, args: ['spinner', { static: false },] }]
    };
    return FivRefresher;
}());
export { FivRefresher };
if (false) {
    /** @type {?} */
    FivRefresher.prototype.hintText;
    /** @type {?} */
    FivRefresher.prototype.maxPullHeight;
    /** @type {?} */
    FivRefresher.prototype.minPullHeight;
    /** @type {?} */
    FivRefresher.prototype.fivProgressChanged;
    /** @type {?} */
    FivRefresher.prototype.fivRefresh;
    /** @type {?} */
    FivRefresher.prototype.spinner;
    /** @type {?} */
    FivRefresher.prototype.hintVisible;
    /** @type {?} */
    FivRefresher.prototype.currentProgress;
    /** @type {?} */
    FivRefresher.prototype.refreshing;
    /**
     * @type {?}
     * @private
     */
    FivRefresher.prototype.$onDestroy;
    /**
     * @type {?}
     * @private
     */
    FivRefresher.prototype.builder;
    /**
     * @type {?}
     * @private
     */
    FivRefresher.prototype.refresher;
    /**
     * @type {?}
     * @private
     */
    FivRefresher.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FivRefresher.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVmcmVzaGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXZldGhyZWUvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9yZWZyZXNoZXIvcmVmcmVzaGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlEQUFpRCxDQUFDO0FBQ3RGLE9BQU8sRUFDTCxTQUFTLEVBRVQsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxTQUFTLEVBRVYsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNMLE9BQU8sRUFDUCxLQUFLLEVBQ0wsVUFBVSxFQUNWLE9BQU8sRUFDUCxnQkFBZ0IsRUFDakIsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQWMsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUU3RTtJQStDRSxzQkFDVSxPQUF5QixFQUN6QixTQUFxQixFQUNyQixRQUFtQixFQUNuQixRQUFrQjtRQUhsQixZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUN6QixjQUFTLEdBQVQsU0FBUyxDQUFZO1FBQ3JCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWpCbkIsYUFBUSxHQUFHLFdBQVcsQ0FBQztRQUN2QixrQkFBYSxHQUFHLEdBQUcsQ0FBQztRQUNwQixrQkFBYSxHQUFHLEdBQUcsQ0FB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QztvQ0FDVixTQUFTLEVBQUUsbUNBQW1DO2lDQUMvQyxDQUFDO2dDQUNGLE9BQU8sQ0FDTCxzQkFBc0IsRUFDdEIsS0FBSyxDQUFDO29DQUNKLEtBQUssRUFBRSxNQUFNO29DQUNiLFNBQVMsRUFBRSxtQ0FBbUM7aUNBQy9DLENBQUMsQ0FDSDs2QkFDRixDQUFDO3lCQUNILENBQUM7cUJBQ0g7O2lCQUNGOzs7O2dCQXRDQyxnQkFBZ0I7Z0JBVmhCLFVBQVU7Z0JBRVYsU0FBUztnQkFVVSxRQUFROzs7MkJBc0MxQixLQUFLO2dDQUNMLEtBQUs7Z0NBQ0wsS0FBSztxQ0FDTCxNQUFNOzZCQUNOLE1BQU07MEJBQ04sU0FBUyxTQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7O0lBMk16QyxtQkFBQztDQUFBLEFBbFBELElBa1BDO1NBak5ZLFlBQVk7OztJQUN2QixnQ0FBZ0M7O0lBQ2hDLHFDQUE2Qjs7SUFDN0IscUNBQTZCOztJQUM3QiwwQ0FBd0U7O0lBQ3hFLGtDQUFzRTs7SUFDdEUsK0JBQXNFOztJQUN0RSxtQ0FBb0I7O0lBQ3BCLHVDQUFvQjs7SUFFcEIsa0NBQW1COzs7OztJQUVuQixrQ0FBbUM7Ozs7O0lBR2pDLCtCQUFpQzs7Ozs7SUFDakMsaUNBQTZCOzs7OztJQUM3QixnQ0FBMkI7Ozs7O0lBQzNCLGdDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRha2VVbnRpbCwgdGFwLCBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEZpdlB1bGwgfSBmcm9tICcuLy4uL3B1bGwvcHVsbC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRml2UmVmcmVzaGVyQ29udGVudCB9IGZyb20gJy4vcmVmcmVzaGVyLWNvbnRlbnQvcmVmcmVzaGVyLWNvbnRlbnQuY29tcG9uZW50JztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgUmVuZGVyZXIyLFxuICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBhbmltYXRlLFxuICBzdHlsZSxcbiAgdHJhbnNpdGlvbixcbiAgdHJpZ2dlcixcbiAgQW5pbWF0aW9uQnVpbGRlclxufSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IElvbkNvbnRlbnQsIFBsYXRmb3JtIH0gZnJvbSAnQGlvbmljL2FuZ3VsYXInO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZWFzZU91dFNpbmUsIHR3ZWVuLCByZXZlcnNlIH0gZnJvbSAnQGZpdmV0aHJlZS9uZ3gtcnhqcy1hbmltYXRpb25zJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZml2LXJlZnJlc2hlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9yZWZyZXNoZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9yZWZyZXNoZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgYW5pbWF0aW9uczogW1xuICAgIHRyaWdnZXIoJ2hpbnRBbmltJywgW1xuICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiAqJywgW1xuICAgICAgICBzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMHB4KSB0cmFuc2xhdGVYKC01MCUpJyB9KSxcbiAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAnMTUwbXMgZWFzZS1pbicsXG4gICAgICAgICAgc3R5bGUoe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoNzJweCkgdHJhbnNsYXRlWCgtNTAlKSdcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICBdKSxcbiAgICAgIHRyYW5zaXRpb24oJyogPT4gdm9pZCcsIFtcbiAgICAgICAgc3R5bGUoe1xuICAgICAgICAgIHdpZHRoOiAnKicsXG4gICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDcycHgpIHRyYW5zbGF0ZVgoLTUwJSknXG4gICAgICAgIH0pLFxuICAgICAgICBhbmltYXRlKFxuICAgICAgICAgICcxNTBtcyAxMjVtcyBlYXNlLW91dCcsXG4gICAgICAgICAgc3R5bGUoe1xuICAgICAgICAgICAgd2lkdGg6ICc0MHB4JyxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoNzJweCkgdHJhbnNsYXRlWCgtNTAlKSdcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICBdKVxuICAgIF0pXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgRml2UmVmcmVzaGVyIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBoaW50VGV4dCA9ICduZXcgcG9zdHMnO1xuICBASW5wdXQoKSBtYXhQdWxsSGVpZ2h0ID0gMTY4O1xuICBASW5wdXQoKSBtaW5QdWxsSGVpZ2h0ID0gMTEyO1xuICBAT3V0cHV0KCkgZml2UHJvZ3Jlc3NDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGZpdlJlZnJlc2g6IEV2ZW50RW1pdHRlcjxGaXZSZWZyZXNoZXI+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAVmlld0NoaWxkKCdzcGlubmVyJywgeyBzdGF0aWM6IGZhbHNlIH0pIHNwaW5uZXI6IEZpdlJlZnJlc2hlckNvbnRlbnQ7XG4gIGhpbnRWaXNpYmxlID0gZmFsc2U7XG4gIGN1cnJlbnRQcm9ncmVzcyA9IDA7XG5cbiAgcmVmcmVzaGluZyA9IGZhbHNlO1xuXG4gIHByaXZhdGUgJG9uRGVzdHJveSA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyLFxuICAgIHByaXZhdGUgcmVmcmVzaGVyOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIHBsYXRmb3JtOiBQbGF0Zm9ybVxuICApIHt9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgYXdhaXQgdGhpcy5hdHRhY2hQdWxsRGlyZWN0aXZlKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLiRvbkRlc3Ryb3kubmV4dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhdHRhY2hQdWxsRGlyZWN0aXZlKCkge1xuICAgIGNvbnN0IGNvbnRlbnQ6IElvbkNvbnRlbnQgPSB0aGlzLnJlZnJlc2hlci5uYXRpdmVFbGVtZW50LmNsb3Nlc3QoXG4gICAgICAnaW9uLWNvbnRlbnQnXG4gICAgKTtcblxuICAgIGlmICghY29udGVudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnVGhlIGZpdi1yZWZyZXNoZXIgY29tcG9uZW50IG5lZWRzIHRvIGJlIGluc2lkZSBvZiBhbiBpb24tY29udGVudC4nXG4gICAgICApO1xuICAgIH1cbiAgICBjb250ZW50LnNjcm9sbEV2ZW50cyA9IHRydWU7XG4gICAgY29uc3Qgc2Nyb2xsID0gYXdhaXQgY29udGVudC5nZXRTY3JvbGxFbGVtZW50KCk7XG4gICAgY29uc3QgcHVsbCA9IG5ldyBGaXZQdWxsKG5ldyBFbGVtZW50UmVmKGNvbnRlbnQpLCB0aGlzLnBsYXRmb3JtLCBjb250ZW50KTtcbiAgICBwdWxsLmluaXQoKTtcblxuICAgIHB1bGwuZml2UHVsbFxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcigoKSA9PiAhdGhpcy5yZWZyZXNoaW5nICYmICF0aGlzLmhpbnRWaXNpYmxlKSxcbiAgICAgICAgdGFwKHByb2dyZXNzID0+IHRoaXMuZml2UHVsbChwcm9ncmVzcykpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuXG4gICAgcHVsbC5maXZSZWZyZXNoXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCgpID0+IHRoaXMucmVmcmVzaCgpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuJG9uRGVzdHJveSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcblxuICAgIHB1bGwuZml2Q2FuY2VsXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCgpID0+IHRoaXMubW92ZUJhY2soKSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLiRvbkRlc3Ryb3kpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLnNwaW5uZXIuZml2Q29tcGxldGUucGlwZSh0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KSkuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLmZpdlJlZnJlc2hcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoKCkgPT4gc2Nyb2xsLnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSkpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcmVmcmVzaCgpIHtcbiAgICBpZiAodGhpcy5yZWZyZXNoaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucmVmcmVzaGluZyA9IHRydWU7XG4gICAgdGhpcy5zcGlubmVyLmxvYWQoKTtcbiAgICB0aGlzLnNldFB1bGxBbmltYXRpb25Qcm9ncmVzcygxMTIgLyAxNjgpO1xuICAgIHRoaXMuZml2UmVmcmVzaC5lbWl0KHRoaXMpO1xuICB9XG5cbiAgY29tcGxldGUoKSB7XG4gICAgaWYgKCF0aGlzLnJlZnJlc2hpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zcGlubmVyLmNvbXBsZXRlKCk7XG4gIH1cblxuICBvbkRvbmUoKSB7XG4gICAgdGhpcy5zcGlubmVyLmhpZGUoKTtcbiAgfVxuXG4gIG9uSGlkZGVuKCkge1xuICAgIHRoaXMucmVmcmVzaGluZyA9IGZhbHNlO1xuICAgIHRoaXMuc2V0UHVsbEFuaW1hdGlvblByb2dyZXNzKDApO1xuICB9XG5cbiAgc2hvd0hpbnQoKSB7XG4gICAgdGhpcy5oaW50VmlzaWJsZSA9IHRydWU7XG4gIH1cblxuICBvbkhpbnRDbGlja2VkKCkge1xuICAgIHRoaXMuaGludFZpc2libGUgPSBmYWxzZTtcbiAgfVxuXG4gIHBvc3RIaW50KGV2ZW50KSB7XG4gICAgaWYgKCFldmVudC5mcm9tU3RhdGUgJiYgZXZlbnQudG9TdGF0ZSA9PT0gJ3ZvaWQnKSB7XG4gICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG4gIH1cblxuICBzZXRQdWxsQW5pbWF0aW9uUHJvZ3Jlc3MocHJvZ3Jlc3M6IG51bWJlcikge1xuICAgIHRoaXMuY3VycmVudFByb2dyZXNzID0gcHJvZ3Jlc3M7XG5cbiAgICBpZiAocHJvZ3Jlc3MgPCAxKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgICB0aGlzLnNwaW5uZXIuZWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgYHRyYW5zbGF0ZVkoJHt0aGlzLm1pblB1bGxIZWlnaHQgKiBwcm9ncmVzc31weClgXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGNoYW5nZUFuaW1hdGlvblRvUHJvZ3Jlc3MocHJvZ3Jlc3M6IG51bWJlcik6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgY29uc3QgYW5pbWF0aW9uID0gdGhpcy5idWlsZGVyLmJ1aWxkKFtcbiAgICAgICAgc3R5bGUoe1xuICAgICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHsxMDAgKlxuICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvZ3Jlc3N9cHgpIHJvdGF0ZVooJHszNjAgKiB0aGlzLmN1cnJlbnRQcm9ncmVzc31kZWcpYFxuICAgICAgICB9KSxcbiAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAnODVtcyBlYXNlLWluJyxcbiAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7MTAwICogcHJvZ3Jlc3N9cHgpIHJvdGF0ZVooJHszNjAgKlxuICAgICAgICAgICAgICBwcm9ncmVzc31kZWcpYFxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCBwbGF5ZXIgPSBhbmltYXRpb24uY3JlYXRlKHRoaXMuc3Bpbm5lci5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgcGxheWVyLnBsYXkoKTtcbiAgICAgIHBsYXllci5vbkRvbmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFB1bGxBbmltYXRpb25Qcm9ncmVzcyhwcm9ncmVzcyk7XG4gICAgICAgIHBsYXllci5kZXN0cm95KCk7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZml2UHVsbChwcm9ncmVzczogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRQdWxsQW5pbWF0aW9uUHJvZ3Jlc3MocHJvZ3Jlc3MpO1xuICAgIHRoaXMuc3Bpbm5lci5zaG93KCk7XG4gICAgY29uc3QgdmFsdWUgPSBNYXRoLm1heChcbiAgICAgIDAsXG4gICAgICBNYXRoLm1pbigxMDAsIChwcm9ncmVzcyAqIDEwMCAqIHRoaXMubWF4UHVsbEhlaWdodCkgLyB0aGlzLm1pblB1bGxIZWlnaHQpXG4gICAgKTtcbiAgICB0aGlzLnNwaW5uZXIuc2V0VmFsdWUodmFsdWUgKiAwLjg0KTtcbiAgfVxuXG4gIG1vdmVCYWNrKCkge1xuICAgIGNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYnVpbGRlci5idWlsZChbXG4gICAgICBzdHlsZSh7XG4gICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHt0aGlzLmN1cnJlbnRQcm9ncmVzcyAqXG4gICAgICAgICAgdGhpcy5taW5QdWxsSGVpZ2h0fXB4KSByb3RhdGVaKCR7MzYwICogdGhpcy5jdXJyZW50UHJvZ3Jlc3N9ZGVnKWBcbiAgICAgIH0pLFxuICAgICAgYW5pbWF0ZSgnMjA1bXMgZWFzZS1pbicsIHN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSByb3RhdGVaKDApJyB9KSlcbiAgICBdKTtcbiAgICBjb25zdCBwbGF5ZXIgPSBhbmltYXRpb24uY3JlYXRlKHRoaXMuc3Bpbm5lci5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuXG4gICAgdHdlZW4oZWFzZU91dFNpbmUsIDE0NSlcbiAgICAgIC5waXBlKFxuICAgICAgICByZXZlcnNlKCksXG4gICAgICAgIG1hcChuID0+XG4gICAgICAgICAgTWF0aC5tYXgoXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgTWF0aC5taW4oXG4gICAgICAgICAgICAgIDEwMCxcbiAgICAgICAgICAgICAgKHRoaXMuY3VycmVudFByb2dyZXNzICogbiAqIDEwMCAqIHRoaXMubWF4UHVsbEhlaWdodCkgL1xuICAgICAgICAgICAgICAgIHRoaXMubWluUHVsbEhlaWdodFxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgdGFwKHZhbHVlID0+IHRoaXMuc3Bpbm5lci5zZXRWYWx1ZSh2YWx1ZSkpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gICAgcGxheWVyLnBsYXkoKTtcbiAgICBwbGF5ZXIub25Eb25lKCgpID0+IHtcbiAgICAgIHRoaXMuc2V0UHVsbEFuaW1hdGlvblByb2dyZXNzKDApO1xuICAgICAgdGhpcy5zcGlubmVyLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIHBsYXllci5kZXN0cm95KCk7XG4gICAgfSk7XG4gIH1cblxuICBvblNwaW5uZXJQcm9ncmVzcyhwcm9ncmVzczogbnVtYmVyKSB7XG4gICAgdGhpcy5maXZQcm9ncmVzc0NoYW5nZWQuZW1pdChwcm9ncmVzcyk7XG4gICAgdGhpcy5yZW5kZXJlclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgLnNldFN0eWxlKFxuICAgICAgICB0aGlzLnNwaW5uZXIuZWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgICAndHJhbnNmb3JtJyxcbiAgICAgICAgYHRyYW5zbGF0ZVkoJHt0aGlzLm1heFB1bGxIZWlnaHQgKlxuICAgICAgICAgIHRoaXMuY3VycmVudFByb2dyZXNzfXB4KSByb3RhdGVaKCR7KDM2MCAqIHByb2dyZXNzKSAvIDIwMH1kZWcpYFxuICAgICAgKTtcbiAgfVxufVxuIl19