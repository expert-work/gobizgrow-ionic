/**
 * @fileoverview added by tsickle
 * Generated from: lib/popover/popover.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { animIn, animOut } from './popover.animations';
import { DomSanitizer } from '@angular/platform-browser';
import { Component, ViewChild, Input, ViewEncapsulation, Host, Optional, ElementRef } from '@angular/core';
import { FivOverlay } from '../overlay/overlay.component';
import { Platform, IonContent } from '@ionic/angular';
import { fromEvent, Subject, merge, from } from 'rxjs';
import { tap, takeUntil, map, throttleTime, filter, flatMap } from 'rxjs/operators';
import { NavigationStart, Router } from '@angular/router';
import { after } from '@fivethree/ngx-rxjs-animations';
export class FivPopover {
    /**
     * @param {?} platform
     * @param {?} content
     * @param {?} dom
     * @param {?} router
     */
    constructor(platform, content, dom, router) {
        this.platform = platform;
        this.content = content;
        this.dom = dom;
        this.router = router;
        this.arrow = false;
        this.arrowWidth = 24;
        this.arrowHeight = this.arrowWidth / 1.6;
        this.arrowPosition = 'auto';
        this.backdrop = true;
        this.overlaysTarget = true;
        this.closeOnNavigation = true;
        this.scrollToTarget = false;
        this.scrollSpeed = 100;
        this.position = 'auto';
        this.classes = [];
        this.viewportOnly = true;
        this.hidden = false;
        this.onDestroy$ = new Subject();
        this.onClose$ = new Subject();
        this.inDuration = 200;
        this.outDuration = 80;
        this.animationIn = (/**
         * @param {?} element
         * @return {?}
         */
        (element) => animIn(element, this._position, this.inDuration));
        this.animationOut = (/**
         * @param {?} element
         * @return {?}
         */
        (element) => animOut(element, this.outDuration));
    }
    /**
     * @return {?}
     */
    get styles() {
        if (!this._position) {
            return;
        }
        return this.dom.bypassSecurityTrustStyle(` width: ${this.width ? this.width + 'px' : 'auto'}; 
        height: ${this.height ? this.height + 'px' : 'auto'}; 
        left: ${this.getContainerLeft()}px; 
        top: ${this.getContainerTop()}px;`);
    }
    /**
     * @return {?}
     */
    get triangle() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isHorizontal) {
            return `${this.arrowHeight},0 0,${this.arrowWidth / 2} ${this.arrowHeight},${this.arrowWidth}`;
        }
        return `0,${this.arrowHeight} ${this.arrowWidth / 2},0 ${this.arrowWidth},${this.arrowHeight}`;
    }
    /**
     * @return {?}
     */
    get svgStyles() {
        if (!this._position) {
            return;
        }
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const rotate = (this.position === 'auto' && this._position.vertical === 'bottom') ||
            this.position === 'left';
        return this.dom.bypassSecurityTrustStyle(`height: ${isHorizontal ? this.arrowWidth : this.arrowHeight}px; 
      width: ${isHorizontal ? this.arrowHeight : this.arrowWidth}px; 
      top: ${this.getArrowTop()}px; 
      left: ${this.getArrowLeft()}px;
      transform: rotateZ(${rotate ? 180 : 0}deg);`);
    }
    /**
     * @return {?}
     */
    get animationStyles() {
        if (!this._position) {
            return;
        }
        return this.dom.bypassSecurityTrustStyle(`height: ${this.arrowHeight}px; 
      width: ${this.arrowWidth}px; 
      top: ${this.getArrowTop()}px; 
      left: ${this.getArrowLeft()}px;
      transform: rotateZ(${this._position.vertical === 'bottom' ? 180 : 0}deg);`);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.router.events
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        event => event instanceof NavigationStart)), filter((/**
         * @return {?}
         */
        () => this.closeOnNavigation && this.overlay.open)), tap((/**
         * @return {?}
         */
        () => this.close())), takeUntil(this.onDestroy$))
            .subscribe();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() { }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.onDestroy$.next();
    }
    /**
     * @return {?}
     */
    close() {
        this.animationOut(this.animationContainer)
            .pipe(after((/**
         * @return {?}
         */
        () => {
            this.overlay.hide();
            this.onClose$.next();
        })))
            .subscribe();
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    getPositionOfTarget(target) {
        /** @type {?} */
        const rect = target.getBoundingClientRect();
        return this.calculcatePositioning(rect.top, rect.left, rect.bottom, rect.right, rect.height, rect.width);
    }
    /**
     * @param {?} target
     * @return {?}
     */
    open(target) {
        /** @type {?} */
        let element;
        if (target instanceof MouseEvent) {
            element = (/** @type {?} */ (target.target));
        }
        else if (target instanceof ElementRef) {
            element = (/** @type {?} */ (target.nativeElement));
        }
        else {
            return;
        }
        this.openTarget(element);
    }
    /**
     * @param {?} target
     * @return {?}
     */
    openTarget(target) {
        /** @type {?} */
        const position = this.getPositionOfTarget(target);
        this.openAtPosition(target, position);
        this.watchResize(target);
        this.watchScroll(target);
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    watchResize(target) {
        if (!this.viewportOnly) {
            return;
        }
        fromEvent(window, 'resize')
            .pipe(flatMap((/**
         * @return {?}
         */
        () => this.filterInViewport(target))), throttleTime(50), map((/**
         * @return {?}
         */
        () => this.getPositionOfTarget(target))), tap((/**
         * @param {?} pos
         * @return {?}
         */
        pos => (this._position = pos))), takeUntil(this.onDestroy$))
            .subscribe();
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    watchScroll(target) {
        if (!this.viewportOnly) {
            return;
        }
        if (this.content && !this.backdrop) {
            this.content.scrollEvents = true;
            merge(fromEvent(window, 'mousewheel'), fromEvent(window, 'touchmove'), this.content.ionScroll)
                .pipe(flatMap((/**
             * @return {?}
             */
            () => this.filterInViewport(target))), map((/**
             * @return {?}
             */
            () => this.getPositionOfTarget(target))), tap((/**
             * @param {?} pos
             * @return {?}
             */
            pos => (this._position = pos))), takeUntil(this.onDestroy$))
                .subscribe();
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    filterInViewport(target) {
        return from(this.inViewport(target.getBoundingClientRect())).pipe(tap((/**
         * @param {?} inViewport
         * @return {?}
         */
        inViewport => !inViewport ? (this.hidden = true) : (this.hidden = false))), filter((/**
         * @param {?} inViewPort
         * @return {?}
         */
        inViewPort => this.overlay.open && inViewPort)));
    }
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    openAtPosition(target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.scrollToPosition(target, position);
            this._position = position;
            this.overlay.show();
        });
    }
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    scrollToPosition(target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (this.content && this.scrollToTarget) {
                /** @type {?} */
                const isInViewport = yield this.inViewport(target.getBoundingClientRect());
                if (isInViewport) {
                    return;
                }
                yield this.content.scrollToPoint(position.left, position.top, this.scrollSpeed);
            }
        });
    }
    /**
     * @param {?} position
     * @return {?}
     */
    inViewport(position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const height = this.platform.height();
            /** @type {?} */
            const width = this.platform.width();
            return (position.top <= height &&
                position.bottom >= 0 &&
                position.left < width &&
                position.right > 0);
        });
    }
    /**
     * @private
     * @param {?} top
     * @param {?} left
     * @param {?} bottom
     * @param {?} right
     * @param {?} targetHeight
     * @param {?} targetWidth
     * @return {?}
     */
    calculcatePositioning(top, left, bottom, right, targetHeight, targetWidth) {
        // calculates the position of the popover without considering arrow and overlay offset
        /** @type {?} */
        const width = this.platform.width();
        /** @type {?} */
        const height = this.platform.height();
        /** @type {?} */
        const _left = this.position === 'right' ||
            (width / 2 > left && this.position !== 'left');
        /** @type {?} */
        const _right = this.position === 'left' ||
            (width / 2 <= left && this.position !== 'right');
        /** @type {?} */
        const _top = this.position === 'below' ||
            (height / 2 > top && this.position !== 'above');
        /** @type {?} */
        const _bottom = this.position === 'above' ||
            (height / 2 <= top && this.position !== 'below');
        // transform origin
        /** @type {?} */
        let horizontal = 'left';
        /** @type {?} */
        let vertical = 'top';
        if (_left && _top) {
            // top left
            horizontal = 'left';
            vertical = 'top';
        }
        else if (_right && _bottom) {
            // bottom right
            left = right - this.width;
            top = bottom - this.height;
            horizontal = 'right';
            vertical = 'bottom';
        }
        else if (_right && _top) {
            // top right
            left = right - this.width;
            horizontal = 'right';
            vertical = 'top';
        }
        else if (_left && _bottom) {
            // bottom left
            top = bottom - this.height;
            horizontal = 'left';
            vertical = 'bottom';
        }
        return {
            top,
            left,
            bottom,
            right,
            targetHeight,
            targetWidth,
            horizontal,
            vertical
        };
    }
    /**
     * @private
     * @return {?}
     */
    getArrowTop() {
        /** @type {?} */
        const isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isVert) {
            return this._position.vertical === 'top'
                ? -1 * this.arrowHeight
                : this.height;
        }
        if (this.arrowPosition === 'center') {
            return this.height / 2 - this.arrowWidth / 2;
        }
        return this._position.vertical === 'top'
            ? this._position.targetHeight / 2 - this.arrowHeight / 2
            : this.height - this.arrowHeight / 2 - this._position.targetHeight / 2;
    }
    /**
     * @private
     * @return {?}
     */
    getArrowLeft() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isHorizontal) {
            return this._position.horizontal === 'left'
                ? -1 * this.arrowHeight
                : this.width;
        }
        if (this.arrowPosition === 'center') {
            return this.width / 2 - this.arrowHeight / 2;
        }
        return this._position.horizontal === 'left'
            ? this._position.targetWidth / 2 - this.arrowWidth / 2
            : this.width - this.arrowWidth / 2 - this._position.targetWidth / 2;
    }
    /**
     * @private
     * @return {?}
     */
    getContainerTop() {
        /** @type {?} */
        const isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const isTop = this._position.vertical === 'top';
        /** @type {?} */
        let offset = 0;
        if (this.arrow && isTop) {
            offset -= this.getVerticalArrowOffset();
        }
        else if (this.arrow && !isTop) {
            offset += this.getVerticalArrowOffset();
        }
        if (!isVert) {
            return this._position.top + offset;
        }
        if (!this.overlaysTarget && isTop) {
            offset += this._position.targetHeight;
        }
        else if (!this.overlaysTarget && !isTop) {
            offset -= this._position.targetHeight;
        }
        if (this.arrow && isTop) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isTop) {
            offset -= this.arrowHeight;
        }
        return this._position.top + offset;
    }
    /**
     * @private
     * @return {?}
     */
    getVerticalArrowOffset() {
        /** @type {?} */
        let offset = 0;
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (this.arrowPosition === 'center' && isHorizontal) {
            offset += this.height / 2 - this._position.targetHeight / 2;
        }
        return offset;
    }
    /**
     * @private
     * @return {?}
     */
    getHorizontalArrowOffset() {
        /** @type {?} */
        let offset = 0;
        /** @type {?} */
        const isVertical = ['above', 'auto', 'below'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (this.arrowPosition === 'center' && isVertical) {
            offset += this.width / 2 - this._position.targetWidth / 2;
        }
        return offset;
    }
    /**
     * @private
     * @return {?}
     */
    getContainerLeft() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const isLeft = this._position.horizontal === 'left';
        /** @type {?} */
        let offset = 0;
        if (this.arrow && isLeft) {
            offset -= this.getHorizontalArrowOffset();
        }
        else if (this.arrow && !isLeft) {
            offset += this.getHorizontalArrowOffset();
        }
        if (!isHorizontal) {
            return this._position.left + offset;
        }
        if (!this.overlaysTarget && isLeft) {
            offset += this._position.targetWidth;
        }
        else if (!this.overlaysTarget && !isLeft) {
            offset -= this._position.targetWidth;
        }
        if (this.arrow && isLeft) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isLeft) {
            offset -= this.arrowHeight;
        }
        return this._position.left + offset;
    }
}
FivPopover.decorators = [
    { type: Component, args: [{
                selector: 'fiv-popover',
                template: "<fiv-overlay>\n  <div *ngIf=\"backdrop && !hidden\" [ngClass]=\"classes\" class=\"fiv-popover-backdrop\" (click)=\"close()\">\n  </div>\n  <div *ngIf=\"!hidden\" [ngClass]=\"classes\" class=\"popover-container\" [style]=\"styles\">\n    <div #animation *ngIf=\"overlay?.open\" class=\"animation-container\" anim [anim.in]=\"animationIn\">\n      <ng-content>\n      </ng-content>\n      <svg *ngIf=\"arrow && !overlaysTarget\" class=\"arrow\" [style]=\"svgStyles\">\n        <polygon [attr.points]=\"triangle\" />\n      </svg>\n    </div>\n\n  </div>\n\n</fiv-overlay>",
                encapsulation: ViewEncapsulation.None,
                styles: [":host{--fiv-popover-backdrop-color:rgba(0, 0, 0, 0.2)}.popover-container{position:absolute;display:block}.animation-container{height:100%;position:relative}svg.arrow{position:absolute;fill:var(--ion-item-background)}.fiv-popover-backdrop{position:absolute;display:block;width:100vw;height:100vh;background:var(--fiv-popover-backdrop-color)}"]
            }] }
];
/** @nocollapse */
FivPopover.ctorParameters = () => [
    { type: Platform },
    { type: IonContent, decorators: [{ type: Host }, { type: Optional }] },
    { type: DomSanitizer },
    { type: Router }
];
FivPopover.propDecorators = {
    overlay: [{ type: ViewChild, args: [FivOverlay, { static: true },] }],
    animationContainer: [{ type: ViewChild, args: ['animation', { static: false },] }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    arrow: [{ type: Input }],
    arrowWidth: [{ type: Input }],
    arrowHeight: [{ type: Input }],
    arrowPosition: [{ type: Input }],
    backdrop: [{ type: Input }],
    overlaysTarget: [{ type: Input }],
    closeOnNavigation: [{ type: Input }],
    scrollToTarget: [{ type: Input }],
    scrollSpeed: [{ type: Input }],
    position: [{ type: Input }],
    classes: [{ type: Input }],
    viewportOnly: [{ type: Input }],
    inDuration: [{ type: Input }],
    outDuration: [{ type: Input }],
    animationIn: [{ type: Input }],
    animationOut: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FivPopover.prototype.overlay;
    /** @type {?} */
    FivPopover.prototype.animationContainer;
    /** @type {?} */
    FivPopover.prototype.width;
    /** @type {?} */
    FivPopover.prototype.height;
    /** @type {?} */
    FivPopover.prototype.arrow;
    /** @type {?} */
    FivPopover.prototype.arrowWidth;
    /** @type {?} */
    FivPopover.prototype.arrowHeight;
    /** @type {?} */
    FivPopover.prototype.arrowPosition;
    /** @type {?} */
    FivPopover.prototype.backdrop;
    /** @type {?} */
    FivPopover.prototype.overlaysTarget;
    /** @type {?} */
    FivPopover.prototype.closeOnNavigation;
    /** @type {?} */
    FivPopover.prototype.scrollToTarget;
    /** @type {?} */
    FivPopover.prototype.scrollSpeed;
    /** @type {?} */
    FivPopover.prototype.position;
    /** @type {?} */
    FivPopover.prototype.classes;
    /** @type {?} */
    FivPopover.prototype.viewportOnly;
    /** @type {?} */
    FivPopover.prototype._position;
    /** @type {?} */
    FivPopover.prototype.hidden;
    /** @type {?} */
    FivPopover.prototype.onDestroy$;
    /** @type {?} */
    FivPopover.prototype.onClose$;
    /** @type {?} */
    FivPopover.prototype.inDuration;
    /** @type {?} */
    FivPopover.prototype.outDuration;
    /** @type {?} */
    FivPopover.prototype.animationIn;
    /** @type {?} */
    FivPopover.prototype.animationOut;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.content;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.dom;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvcG9wb3Zlci9wb3BvdmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQ0wsU0FBUyxFQUVULFNBQVMsRUFDVCxLQUFLLEVBQ0wsaUJBQWlCLEVBQ2pCLElBQUksRUFDSixRQUFRLEVBRVIsVUFBVSxFQUVYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUNMLEdBQUcsRUFDSCxTQUFTLEVBQ1QsR0FBRyxFQUNILFlBQVksRUFDWixNQUFNLEVBQ04sT0FBTyxFQUNSLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQVExRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFRdkQsTUFBTSxPQUFPLFVBQVU7Ozs7Ozs7SUFxRnJCLFlBQ1UsUUFBa0IsRUFDRSxPQUFtQixFQUN2QyxHQUFpQixFQUNqQixNQUFjO1FBSGQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNFLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDdkMsUUFBRyxHQUFILEdBQUcsQ0FBYztRQUNqQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBbkZmLFVB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b0NBQWdDOztJQUNoQyxpQ0FBMkI7O0lBQzNCLDhCQUErQzs7SUFDL0MsNkJBQWdDOztJQUNoQyxrQ0FBNkI7O0lBRTdCLCtCQUEyQjs7SUFDM0IsNEJBQWU7O0lBQ2YsZ0NBQTJCOztJQUMzQiw4QkFBeUI7O0lBRXpCLGdDQUEwQjs7SUFDMUIsaUNBQTBCOztJQUMxQixpQ0FDbUQ7O0lBQ25ELGtDQUNxQzs7Ozs7SUF5RG5DLDhCQUEwQjs7Ozs7SUFDMUIsNkJBQStDOzs7OztJQUMvQyx5QkFBeUI7Ozs7O0lBQ3pCLDRCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuaW1JbiwgYW5pbU91dCB9IGZyb20gJy4vcG9wb3Zlci5hbmltYXRpb25zJztcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgSW5wdXQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBIb3N0LFxuICBPcHRpb25hbCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRml2T3ZlcmxheSB9IGZyb20gJy4uL292ZXJsYXkvb3ZlcmxheS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUGxhdGZvcm0sIElvbkNvbnRlbnQgfSBmcm9tICdAaW9uaWMvYW5ndWxhcic7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QsIG1lcmdlLCBmcm9tIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICB0YXAsXG4gIHRha2VVbnRpbCxcbiAgbWFwLFxuICB0aHJvdHRsZVRpbWUsXG4gIGZpbHRlcixcbiAgZmxhdE1hcFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uU3RhcnQsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQge1xuICBQb3BvdmVyUG9zaXRpb25pbmcsXG4gIFBvcG92ZXJQb3NpdGlvbixcbiAgUG9wb3Zlckhvcml6b250YWxBbGlnbixcbiAgUG9wb3ZlclZlcnRpY2FsQWxpZ24sXG4gIFBvcG92ZXJBcnJvd1Bvc2l0aW9uaW5nXG59IGZyb20gJy4vcG9wb3Zlci50eXBlcyc7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gJ0BmaXZldGhyZWUvbmd4LXJ4anMtYW5pbWF0aW9ucyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Zpdi1wb3BvdmVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvcG92ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wb3BvdmVyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgRml2UG9wb3ZlciBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZChGaXZPdmVybGF5LCB7IHN0YXRpYzogdHJ1ZSB9KSBvdmVybGF5OiBGaXZPdmVybGF5O1xuICBAVmlld0NoaWxkKCdhbmltYXRpb24nLCB7IHN0YXRpYzogZmFsc2UgfSkgYW5pbWF0aW9uQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICBASW5wdXQoKSBhcnJvdyA9IGZhbHNlO1xuICBASW5wdXQoKSBhcnJvd1dpZHRoID0gMjQ7XG4gIEBJbnB1dCgpIGFycm93SGVpZ2h0OiBudW1iZXIgPSB0aGlzLmFycm93V2lkdGggLyAxLjY7XG4gIEBJbnB1dCgpIGFycm93UG9zaXRpb246IFBvcG92ZXJBcnJvd1Bvc2l0aW9uaW5nID0gJ2F1dG8nO1xuICBASW5wdXQoKSBiYWNrZHJvcCA9IHRydWU7XG4gIEBJbnB1dCgpIG92ZXJsYXlzVGFyZ2V0ID0gdHJ1ZTtcbiAgQElucHV0KCkgY2xvc2VPbk5hdmlnYXRpb24gPSB0cnVlO1xuICBASW5wdXQoKSBzY3JvbGxUb1RhcmdldCA9IGZhbHNlO1xuICBASW5wdXQoKSBzY3JvbGxTcGVlZCA9IDEwMDtcbiAgQElucHV0KCkgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbmluZyA9ICdhdXRvJztcbiAgQElucHV0KCkgY2xhc3Nlczogc3RyaW5nW10gPSBbXTtcbiAgQElucHV0KCkgdmlld3BvcnRPbmx5ID0gdHJ1ZTtcblxuICBfcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbjtcbiAgaGlkZGVuID0gZmFsc2U7XG4gIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuICBvbkNsb3NlJCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgQElucHV0KCkgaW5EdXJhdGlvbiA9IDIwMDtcbiAgQElucHV0KCkgb3V0RHVyYXRpb24gPSA4MDtcbiAgQElucHV0KCkgYW5pbWF0aW9uSW4gPSAoZWxlbWVudDogRWxlbWVudFJlZikgPT5cbiAgICBhbmltSW4oZWxlbWVudCwgdGhpcy5fcG9zaXRpb24sIHRoaXMuaW5EdXJhdGlvbik7XG4gIEBJbnB1dCgpIGFuaW1hdGlvbk91dCA9IChlbGVtZW50OiBFbGVtZW50UmVmKSA9PlxuICAgIGFuaW1PdXQoZWxlbWVudCwgdGhpcy5vdXREdXJhdGlvbik7XG5cbiAgZ2V0IHN0eWxlcygpIHtcbiAgICBpZiAoIXRoaXMuX3Bvc2l0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmRvbS5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoXG4gICAgICBgIHdpZHRoOiAke3RoaXMud2lkdGggPyB0aGlzLndpZHRoICsgJ3B4JyA6ICdhdXRvJ307IFxuICAgICAgICBoZWlnaHQ6ICR7dGhpcy5oZWlnaHQgPyB0aGlzLmhlaWdodCArICdweCcgOiAnYXV0byd9OyBcbiAgICAgICAgbGVmdDogJHt0aGlzLmdldENvbnRhaW5lckxlZnQoKX1weDsgXG4gICAgICAgIHRvcDogJHt0aGlzLmdldENvbnRhaW5lclRvcCgpfXB4O2BcbiAgICApO1xuICB9XG5cbiAgZ2V0IHRyaWFuZ2xlKCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5hcnJvd0hlaWdodH0sMCAwLCR7dGhpcy5hcnJvd1dpZHRoIC8gMn0gJHtcbiAgICAgICAgdGhpcy5hcnJvd0hlaWdodFxuICAgICAgfSwke3RoaXMuYXJyb3dXaWR0aH1gO1xuICAgIH1cbiAgICByZXR1cm4gYDAsJHt0aGlzLmFycm93SGVpZ2h0fSAke3RoaXMuYXJyb3dXaWR0aCAvIDJ9LDAgJHt0aGlzLmFycm93V2lkdGh9LCR7XG4gICAgICB0aGlzLmFycm93SGVpZ2h0XG4gICAgfWA7XG4gIH1cblxuICBnZXQgc3ZnU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGNvbnN0IHJvdGF0ZSA9XG4gICAgICAodGhpcy5wb3NpdGlvbiA9PT0gJ2F1dG8nICYmIHRoaXMuX3Bvc2l0aW9uLnZlcnRpY2FsID09PSAnYm90dG9tJykgfHxcbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JztcbiAgICByZXR1cm4gdGhpcy5kb20uYnlwYXNzU2VjdXJpdHlUcnVzdFN0eWxlKFxuICAgICAgYGhlaWdodDogJHtpc0hvcml6b250YWwgPyB0aGlzLmFycm93V2lkdGggOiB0aGlzLmFycm93SGVpZ2h0fXB4OyBcbiAgICAgIHdpZHRoOiAke2lzSG9yaXpvbnRhbCA/IHRoaXMuYXJyb3dIZWlnaHQgOiB0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHtyb3RhdGUgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBnZXQgYW5pbWF0aW9uU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZG9tLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShcbiAgICAgIGBoZWlnaHQ6ICR7dGhpcy5hcnJvd0hlaWdodH1weDsgXG4gICAgICB3aWR0aDogJHt0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHt0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ2JvdHRvbScgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBsYXRmb3JtOiBQbGF0Zm9ybSxcbiAgICBASG9zdCgpIEBPcHRpb25hbCgpIHByaXZhdGUgY29udGVudDogSW9uQ29udGVudCxcbiAgICBwcml2YXRlIGRvbTogRG9tU2FuaXRpemVyLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucm91dGVyLmV2ZW50c1xuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcjxOYXZpZ2F0aW9uU3RhcnQ+KGV2ZW50ID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvblN0YXJ0KSxcbiAgICAgICAgZmlsdGVyKCgpID0+IHRoaXMuY2xvc2VPbk5hdmlnYXRpb24gJiYgdGhpcy5vdmVybGF5Lm9wZW4pLFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5jbG9zZSgpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHt9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuYW5pbWF0aW9uT3V0KHRoaXMuYW5pbWF0aW9uQ29udGFpbmVyKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGFmdGVyKCgpID0+IHtcbiAgICAgICAgICB0aGlzLm92ZXJsYXkuaGlkZSgpO1xuICAgICAgICAgIHRoaXMub25DbG9zZSQubmV4dCgpO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB0aGlzLmNhbGN1bGNhdGVQb3NpdGlvbmluZyhcbiAgICAgIHJlY3QudG9wLFxuICAgICAgcmVjdC5sZWZ0LFxuICAgICAgcmVjdC5ib3R0b20sXG4gICAgICByZWN0LnJpZ2h0LFxuICAgICAgcmVjdC5oZWlnaHQsXG4gICAgICByZWN0LndpZHRoXG4gICAgKTtcbiAgfVxuXG4gIG9wZW4odGFyZ2V0OiBNb3VzZUV2ZW50IHwgRWxlbWVudFJlZikge1xuICAgIGxldCBlbGVtZW50O1xuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSB7XG4gICAgICBlbGVtZW50ID0gdGFyZ2V0LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYpIHtcbiAgICAgIGVsZW1lbnQgPSB0YXJnZXQubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wZW5UYXJnZXQoZWxlbWVudCk7XG4gIH1cblxuICBvcGVuVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0UG9zaXRpb25PZlRhcmdldCh0YXJnZXQpO1xuICAgIHRoaXMub3BlbkF0UG9zaXRpb24odGFyZ2V0LCBwb3NpdGlvbik7XG4gICAgdGhpcy53YXRjaFJlc2l6ZSh0YXJnZXQpO1xuICAgIHRoaXMud2F0Y2hTY3JvbGwodGFyZ2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgd2F0Y2hSZXNpemUodGFyZ2V0OiBIVE1MRWxlbWVudCkge1xuICAgIGlmICghdGhpcy52aWV3cG9ydE9ubHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZnJvbUV2ZW50KHdpbmRvdywgJ3Jlc2l6ZScpXG4gICAgICAucGlwZShcbiAgICAgICAgZmxhdE1hcCgoKSA9PiB0aGlzLmZpbHRlckluVmlld3BvcnQodGFyZ2V0KSksXG4gICAgICAgIHRocm90dGxlVGltZSg1MCksXG4gICAgICAgIG1hcCgoKSA9PiB0aGlzLmdldFBvc2l0aW9uT2ZUYXJnZXQodGFyZ2V0KSksXG4gICAgICAgIHRhcChwb3MgPT4gKHRoaXMuX3Bvc2l0aW9uID0gcG9zKSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIHdhdGNoU2Nyb2xsKHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIXRoaXMudmlld3BvcnRPbmx5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbnRlbnQgJiYgIXRoaXMuYmFja2Ryb3ApIHtcbiAgICAgIHRoaXMuY29udGVudC5zY3JvbGxFdmVudHMgPSB0cnVlO1xuICAgICAgbWVyZ2UoXG4gICAgICAgIGZyb21FdmVudCh3aW5kb3csICdtb3VzZXdoZWVsJyksXG4gICAgICAgIGZyb21FdmVudCh3aW5kb3csICd0b3VjaG1vdmUnKSxcbiAgICAgICAgdGhpcy5jb250ZW50LmlvblNjcm9sbFxuICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBmbGF0TWFwKCgpID0+IHRoaXMuZmlsdGVySW5WaWV3cG9ydCh0YXJnZXQpKSxcbiAgICAgICAgICBtYXAoKCkgPT4gdGhpcy5nZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldCkpLFxuICAgICAgICAgIHRhcChwb3MgPT4gKHRoaXMuX3Bvc2l0aW9uID0gcG9zKSksXG4gICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJJblZpZXdwb3J0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICByZXR1cm4gZnJvbSh0aGlzLmluVmlld3BvcnQodGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSkucGlwZShcbiAgICAgIHRhcChpblZpZXdwb3J0ID0+XG4gICAgICAgICFpblZpZXdwb3J0ID8gKHRoaXMuaGlkZGVuID0gdHJ1ZSkgOiAodGhpcy5oaWRkZW4gPSBmYWxzZSlcbiAgICAgICksXG4gICAgICBmaWx0ZXIoaW5WaWV3UG9ydCA9PiB0aGlzLm92ZXJsYXkub3BlbiAmJiBpblZpZXdQb3J0KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9wZW5BdFBvc2l0aW9uKHRhcmdldDogSFRNTEVsZW1lbnQsIHBvc2l0aW9uOiBQb3BvdmVyUG9zaXRpb24pIHtcbiAgICBhd2FpdCB0aGlzLnNjcm9sbFRvUG9zaXRpb24odGFyZ2V0LCBwb3NpdGlvbik7XG4gICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB0aGlzLm92ZXJsYXkuc2hvdygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzY3JvbGxUb1Bvc2l0aW9uKFxuICAgIHRhcmdldDogSFRNTEVsZW1lbnQsXG4gICAgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvblxuICApIHtcbiAgICBpZiAodGhpcy5jb250ZW50ICYmIHRoaXMuc2Nyb2xsVG9UYXJnZXQpIHtcbiAgICAgIGNvbnN0IGlzSW5WaWV3cG9ydCA9IGF3YWl0IHRoaXMuaW5WaWV3cG9ydChcbiAgICAgICAgdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICApO1xuICAgICAgaWYgKGlzSW5WaWV3cG9ydCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmNvbnRlbnQuc2Nyb2xsVG9Qb2ludChcbiAgICAgICAgcG9zaXRpb24ubGVmdCxcbiAgICAgICAgcG9zaXRpb24udG9wLFxuICAgICAgICB0aGlzLnNjcm9sbFNwZWVkXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBhc3luYyBpblZpZXdwb3J0KHBvc2l0aW9uOiBET01SZWN0IHwgQ2xpZW50UmVjdCkge1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMucGxhdGZvcm0uaGVpZ2h0KCk7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLnBsYXRmb3JtLndpZHRoKCk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgcG9zaXRpb24udG9wIDw9IGhlaWdodCAmJlxuICAgICAgcG9zaXRpb24uYm90dG9tID49IDAgJiZcbiAgICAgIHBvc2l0aW9uLmxlZnQgPCB3aWR0aCAmJlxuICAgICAgcG9zaXRpb24ucmlnaHQgPiAwXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsY2F0ZVBvc2l0aW9uaW5nKFxuICAgIHRvcDogbnVtYmVyLFxuICAgIGxlZnQ6IG51bWJlcixcbiAgICBib3R0b206IG51bWJlcixcbiAgICByaWdodDogbnVtYmVyLFxuICAgIHRhcmdldEhlaWdodDogbnVtYmVyLFxuICAgIHRhcmdldFdpZHRoOiBudW1iZXJcbiAgKTogUG9wb3ZlclBvc2l0aW9uIHtcbiAgICAvLyBjYWxjdWxhdGVzIHRoZSBwb3NpdGlvbiBvZiB0aGUgcG9wb3ZlciB3aXRob3V0IGNvbnNpZGVyaW5nIGFycm93IGFuZCBvdmVybGF5IG9mZnNldFxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5wbGF0Zm9ybS53aWR0aCgpO1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMucGxhdGZvcm0uaGVpZ2h0KCk7XG5cbiAgICBjb25zdCBfbGVmdCA9XG4gICAgICB0aGlzLnBvc2l0aW9uID09PSAncmlnaHQnIHx8XG4gICAgICAod2lkdGggLyAyID4gbGVmdCAmJiB0aGlzLnBvc2l0aW9uICE9PSAnbGVmdCcpO1xuICAgIGNvbnN0IF9yaWdodCA9XG4gICAgICB0aGlzLnBvc2l0aW9uID09PSAnbGVmdCcgfHxcbiAgICAgICh3aWR0aCAvIDIgPD0gbGVmdCAmJiB0aGlzLnBvc2l0aW9uICE9PSAncmlnaHQnKTtcbiAgICBjb25zdCBfdG9wID1cbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdiZWxvdycgfHxcbiAgICAgIChoZWlnaHQgLyAyID4gdG9wICYmIHRoaXMucG9zaXRpb24gIT09ICdhYm92ZScpO1xuICAgIGNvbnN0IF9ib3R0b20gPVxuICAgICAgdGhpcy5wb3NpdGlvbiA9PT0gJ2Fib3ZlJyB8fFxuICAgICAgKGhlaWdodCAvIDIgPD0gdG9wICYmIHRoaXMucG9zaXRpb24gIT09ICdiZWxvdycpO1xuXG4gICAgLy8gdHJhbnNmb3JtIG9yaWdpblxuICAgIGxldCBob3Jpem9udGFsOiBQb3BvdmVySG9yaXpvbnRhbEFsaWduID0gJ2xlZnQnO1xuICAgIGxldCB2ZXJ0aWNhbDogUG9wb3ZlclZlcnRpY2FsQWxpZ24gPSAndG9wJztcblxuICAgIGlmIChfbGVmdCAmJiBfdG9wKSB7XG4gICAgICAvLyB0b3AgbGVmdFxuICAgICAgaG9yaXpvbnRhbCA9ICdsZWZ0JztcbiAgICAgIHZlcnRpY2FsID0gJ3RvcCc7XG4gICAgfSBlbHNlIGlmIChfcmlnaHQgJiYgX2JvdHRvbSkge1xuICAgICAgLy8gYm90dG9tIHJpZ2h0XG4gICAgICBsZWZ0ID0gcmlnaHQgLSB0aGlzLndpZHRoO1xuICAgICAgdG9wID0gYm90dG9tIC0gdGhpcy5oZWlnaHQ7XG4gICAgICBob3Jpem9udGFsID0gJ3JpZ2h0JztcbiAgICAgIHZlcnRpY2FsID0gJ2JvdHRvbSc7XG4gICAgfSBlbHNlIGlmIChfcmlnaHQgJiYgX3RvcCkge1xuICAgICAgLy8gdG9wIHJpZ2h0XG4gICAgICBsZWZ0ID0gcmlnaHQgLSB0aGlzLndpZHRoO1xuICAgICAgaG9yaXpvbnRhbCA9ICdyaWdodCc7XG4gICAgICB2ZXJ0aWNhbCA9ICd0b3AnO1xuICAgIH0gZWxzZSBpZiAoX2xlZnQgJiYgX2JvdHRvbSkge1xuICAgICAgLy8gYm90dG9tIGxlZnRcbiAgICAgIHRvcCA9IGJvdHRvbSAtIHRoaXMuaGVpZ2h0O1xuICAgICAgaG9yaXpvbnRhbCA9ICdsZWZ0JztcbiAgICAgIHZlcnRpY2FsID0gJ2JvdHRvbSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcCxcbiAgICAgIGxlZnQsXG4gICAgICBib3R0b20sXG4gICAgICByaWdodCxcbiAgICAgIHRhcmdldEhlaWdodCxcbiAgICAgIHRhcmdldFdpZHRoLFxuICAgICAgaG9yaXpvbnRhbCxcbiAgICAgIHZlcnRpY2FsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJyb3dUb3AoKSB7XG4gICAgY29uc3QgaXNWZXJ0ID0gWydhdXRvJywgJ2JlbG93JywgJ2Fib3ZlJ10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGlmIChpc1ZlcnQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ3RvcCdcbiAgICAgICAgPyAtMSAqIHRoaXMuYXJyb3dIZWlnaHRcbiAgICAgICAgOiB0aGlzLmhlaWdodDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlaWdodCAvIDIgLSB0aGlzLmFycm93V2lkdGggLyAyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24udmVydGljYWwgPT09ICd0b3AnXG4gICAgICA/IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodCAvIDIgLSB0aGlzLmFycm93SGVpZ2h0IC8gMlxuICAgICAgOiB0aGlzLmhlaWdodCAtIHRoaXMuYXJyb3dIZWlnaHQgLyAyIC0gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0IC8gMjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJyb3dMZWZ0KCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnXG4gICAgICAgID8gLTEgKiB0aGlzLmFycm93SGVpZ2h0XG4gICAgICAgIDogdGhpcy53aWR0aDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiB0aGlzLndpZHRoIC8gMiAtIHRoaXMuYXJyb3dIZWlnaHQgLyAyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnXG4gICAgICA/IHRoaXMuX3Bvc2l0aW9uLnRhcmdldFdpZHRoIC8gMiAtIHRoaXMuYXJyb3dXaWR0aCAvIDJcbiAgICAgIDogdGhpcy53aWR0aCAtIHRoaXMuYXJyb3dXaWR0aCAvIDIgLSB0aGlzLl9wb3NpdGlvbi50YXJnZXRXaWR0aCAvIDI7XG4gIH1cblxuICBwcml2YXRlIGdldENvbnRhaW5lclRvcCgpIHtcbiAgICBjb25zdCBpc1ZlcnQgPSBbJ2F1dG8nLCAnYmVsb3cnLCAnYWJvdmUnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgY29uc3QgaXNUb3AgPSB0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ3RvcCc7XG5cbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuZ2V0VmVydGljYWxBcnJvd09mZnNldCgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hcnJvdyAmJiAhaXNUb3ApIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLmdldFZlcnRpY2FsQXJyb3dPZmZzZXQoKTtcbiAgICB9XG4gICAgaWYgKCFpc1ZlcnQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi50b3AgKyBvZmZzZXQ7XG4gICAgfVxuICAgIGlmICghdGhpcy5vdmVybGF5c1RhcmdldCAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodDtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm92ZXJsYXlzVGFyZ2V0ICYmICFpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfSBlbHNlIGlmICh0aGlzLmFycm93ICYmICFpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi50b3AgKyBvZmZzZXQ7XG4gIH1cblxuICBwcml2YXRlIGdldFZlcnRpY2FsQXJyb3dPZmZzZXQoKSB7XG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGlmICh0aGlzLmFycm93UG9zaXRpb24gPT09ICdjZW50ZXInICYmIGlzSG9yaXpvbnRhbCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuaGVpZ2h0IC8gMiAtIHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodCAvIDI7XG4gICAgfVxuICAgIHJldHVybiBvZmZzZXQ7XG4gIH1cbiAgcHJpdmF0ZSBnZXRIb3Jpem9udGFsQXJyb3dPZmZzZXQoKSB7XG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgY29uc3QgaXNWZXJ0aWNhbCA9IFsnYWJvdmUnLCAnYXV0bycsICdiZWxvdyddLnNvbWUoXG4gICAgICBzID0+IHMgPT09IHRoaXMucG9zaXRpb25cbiAgICApO1xuICAgIGlmICh0aGlzLmFycm93UG9zaXRpb24gPT09ICdjZW50ZXInICYmIGlzVmVydGljYWwpIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLndpZHRoIC8gMiAtIHRoaXMuX3Bvc2l0aW9uLnRhcmdldFdpZHRoIC8gMjtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGFpbmVyTGVmdCgpIHtcbiAgICBjb25zdCBpc0hvcml6b250YWwgPSBbJ2xlZnQnLCAncmlnaHQnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgY29uc3QgaXNMZWZ0ID0gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnO1xuXG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgaWYgKHRoaXMuYXJyb3cgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5nZXRIb3Jpem9udGFsQXJyb3dPZmZzZXQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYXJyb3cgJiYgIWlzTGVmdCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuZ2V0SG9yaXpvbnRhbEFycm93T2Zmc2V0KCk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0hvcml6b250YWwpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5sZWZ0ICsgb2Zmc2V0O1xuICAgIH1cbiAgICBpZiAoIXRoaXMub3ZlcmxheXNUYXJnZXQgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGg7XG4gICAgfSBlbHNlIGlmICghdGhpcy5vdmVybGF5c1RhcmdldCAmJiAhaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYXJyb3cgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5hcnJvd0hlaWdodDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYXJyb3cgJiYgIWlzTGVmdCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5sZWZ0ICsgb2Zmc2V0O1xuICB9XG59XG4iXX0=