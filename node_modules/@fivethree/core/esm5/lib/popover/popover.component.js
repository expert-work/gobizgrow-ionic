/**
 * @fileoverview added by tsickle
 * Generated from: lib/popover/popover.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { animIn, animOut } from './popover.animations';
import { DomSanitizer } from '@angular/platform-browser';
import { Component, ViewChild, Input, ViewEncapsulation, Host, Optional, ElementRef } from '@angular/core';
import { FivOverlay } from '../overlay/overlay.component';
import { Platform, IonContent } from '@ionic/angular';
import { fromEvent, Subject, merge, from } from 'rxjs';
import { tap, takeUntil, map, throttleTime, filter, flatMap } from 'rxjs/operators';
import { NavigationStart, Router } from '@angular/router';
import { after } from '@fivethree/ngx-rxjs-animations';
var FivPopover = /** @class */ (function () {
    function FivPopover(platform, content, dom, router) {
        var _this = this;
        this.platform = platform;
        this.content = content;
        this.dom = dom;
        this.router = router;
        this.arrow = false;
        this.arrowWidth = 24;
        this.arrowHeight = this.arrowWidth / 1.6;
        this.arrowPosition = 'auto';
        this.backdrop = true;
        this.overlaysTarget = true;
        this.closeOnNavigation = true;
        this.scrollToTarget = false;
        this.scrollSpeed = 100;
        this.position = 'auto';
        this.classes = [];
        this.viewportOnly = true;
        this.hidden = false;
        this.onDestroy$ = new Subject();
        this.onClose$ = new Subject();
        this.inDuration = 200;
        this.outDuration = 80;
        this.animationIn = (/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            return animIn(element, _this._position, _this.inDuration);
        });
        this.animationOut = (/**
         * @param {?} element
         * @return {?}
         */
        function (element) {
            return animOut(element, _this.outDuration);
        });
    }
    Object.defineProperty(FivPopover.prototype, "styles", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this._position) {
                return;
            }
            return this.dom.bypassSecurityTrustStyle(" width: " + (this.width ? this.width + 'px' : 'auto') + "; \n        height: " + (this.height ? this.height + 'px' : 'auto') + "; \n        left: " + this.getContainerLeft() + "px; \n        top: " + this.getContainerTop() + "px;");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FivPopover.prototype, "triangle", {
        get: /**
         * @return {?}
         */
        function () {
            var _this = this;
            /** @type {?} */
            var isHorizontal = ['left', 'right'].some((/**
             * @param {?} s
             * @return {?}
             */
            function (s) { return s === _this.position; }));
            if (isHorizontal) {
                return this.arrowHeight + ",0 0," + this.arrowWidth / 2 + " " + this.arrowHeight + "," + this.arrowWidth;
            }
            return "0," + this.arrowHeight + " " + this.arrowWidth / 2 + ",0 " + this.arrowWidth + "," + this.arrowHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FivPopover.prototype, "svgStyles", {
        get: /**
         * @return {?}
         */
        function () {
            var _this = this;
            if (!this._position) {
                return;
            }
            /** @type {?} */
            var isHorizontal = ['left', 'right'].some((/**
             * @param {?} s
             * @return {?}
             */
            function (s) { return s === _this.position; }));
            /** @type {?} */
            var rotate = (this.position === 'auto' && this._position.vertical === 'bottom') ||
                this.position === 'left';
            return this.dom.bypassSecurityTrustStyle("height: " + (isHorizontal ? this.arrowWidth : this.arrowHeight) + "px; \n      width: " + (isHorizontal ? this.arrowHeight : this.arrowWidth) + "px; \n      top: " + this.getArrowTop() + "px; \n      left: " + this.getArrowLeft() + "px;\n      transform: rotateZ(" + (rotate ? 180 : 0) + "deg);");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FivPopover.prototype, "animationStyles", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this._position) {
                return;
            }
            return this.dom.bypassSecurityTrustStyle("height: " + this.arrowHeight + "px; \n      width: " + this.arrowWidth + "px; \n      top: " + this.getArrowTop() + "px; \n      left: " + this.getArrowLeft() + "px;\n      transform: rotateZ(" + (this._position.vertical === 'bottom' ? 180 : 0) + "deg);");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FivPopover.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.router.events
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return event instanceof NavigationStart; })), filter((/**
         * @return {?}
         */
        function () { return _this.closeOnNavigation && _this.overlay.open; })), tap((/**
         * @return {?}
         */
        function () { return _this.close(); })), takeUntil(this.onDestroy$))
            .subscribe();
    };
    /**
     * @return {?}
     */
    FivPopover.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    FivPopover.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.onDestroy$.next();
    };
    /**
     * @return {?}
     */
    FivPopover.prototype.close = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.animationOut(this.animationContainer)
            .pipe(after((/**
         * @return {?}
         */
        function () {
            _this.overlay.hide();
            _this.onClose$.next();
        })))
            .subscribe();
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.getPositionOfTarget = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var rect = target.getBoundingClientRect();
        return this.calculcatePositioning(rect.top, rect.left, rect.bottom, rect.right, rect.height, rect.width);
    };
    /**
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.open = /**
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var element;
        if (target instanceof MouseEvent) {
            element = (/** @type {?} */ (target.target));
        }
        else if (target instanceof ElementRef) {
            element = (/** @type {?} */ (target.nativeElement));
        }
        else {
            return;
        }
        this.openTarget(element);
    };
    /**
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.openTarget = /**
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var position = this.getPositionOfTarget(target);
        this.openAtPosition(target, position);
        this.watchResize(target);
        this.watchScroll(target);
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.watchResize = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        var _this = this;
        if (!this.viewportOnly) {
            return;
        }
        fromEvent(window, 'resize')
            .pipe(flatMap((/**
         * @return {?}
         */
        function () { return _this.filterInViewport(target); })), throttleTime(50), map((/**
         * @return {?}
         */
        function () { return _this.getPositionOfTarget(target); })), tap((/**
         * @param {?} pos
         * @return {?}
         */
        function (pos) { return (_this._position = pos); })), takeUntil(this.onDestroy$))
            .subscribe();
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.watchScroll = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        var _this = this;
        if (!this.viewportOnly) {
            return;
        }
        if (this.content && !this.backdrop) {
            this.content.scrollEvents = true;
            merge(fromEvent(window, 'mousewheel'), fromEvent(window, 'touchmove'), this.content.ionScroll)
                .pipe(flatMap((/**
             * @return {?}
             */
            function () { return _this.filterInViewport(target); })), map((/**
             * @return {?}
             */
            function () { return _this.getPositionOfTarget(target); })), tap((/**
             * @param {?} pos
             * @return {?}
             */
            function (pos) { return (_this._position = pos); })), takeUntil(this.onDestroy$))
                .subscribe();
        }
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    FivPopover.prototype.filterInViewport = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        var _this = this;
        return from(this.inViewport(target.getBoundingClientRect())).pipe(tap((/**
         * @param {?} inViewport
         * @return {?}
         */
        function (inViewport) {
            return !inViewport ? (_this.hidden = true) : (_this.hidden = false);
        })), filter((/**
         * @param {?} inViewPort
         * @return {?}
         */
        function (inViewPort) { return _this.overlay.open && inViewPort; })));
    };
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    FivPopover.prototype.openAtPosition = /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    function (target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.scrollToPosition(target, position)];
                    case 1:
                        _a.sent();
                        this._position = position;
                        this.overlay.show();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    FivPopover.prototype.scrollToPosition = /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    function (target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var isInViewport;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.content && this.scrollToTarget)) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.inViewport(target.getBoundingClientRect())];
                    case 1:
                        isInViewport = _a.sent();
                        if (isInViewport) {
                            return [2 /*return*/];
                        }
                        return [4 /*yield*/, this.content.scrollToPoint(position.left, position.top, this.scrollSpeed)];
                    case 2:
                        _a.sent();
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @param {?} position
     * @return {?}
     */
    FivPopover.prototype.inViewport = /**
     * @param {?} position
     * @return {?}
     */
    function (position) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var height, width;
            return tslib_1.__generator(this, function (_a) {
                height = this.platform.height();
                width = this.platform.width();
                return [2 /*return*/, (position.top <= height &&
                        position.bottom >= 0 &&
                        position.left < width &&
                        position.right > 0)];
            });
        });
    };
    /**
     * @private
     * @param {?} top
     * @param {?} left
     * @param {?} bottom
     * @param {?} right
     * @param {?} targetHeight
     * @param {?} targetWidth
     * @return {?}
     */
    FivPopover.prototype.calculcatePositioning = /**
     * @private
     * @param {?} top
     * @param {?} left
     * @param {?} bottom
     * @param {?} right
     * @param {?} targetHeight
     * @param {?} targetWidth
     * @return {?}
     */
    function (top, left, bottom, right, targetHeight, targetWidth) {
        // calculates the position of the popover without considering arrow and overlay offset
        /** @type {?} */
        var width = this.platform.width();
        /** @type {?} */
        var height = this.platform.height();
        /** @type {?} */
        var _left = this.position === 'right' ||
            (width / 2 > left && this.position !== 'left');
        /** @type {?} */
        var _right = this.position === 'left' ||
            (width / 2 <= left && this.position !== 'right');
        /** @type {?} */
        var _top = this.position === 'below' ||
            (height / 2 > top && this.position !== 'above');
        /** @type {?} */
        var _bottom = this.position === 'above' ||
            (height / 2 <= top && this.position !== 'below');
        // transform origin
        /** @type {?} */
        var horizontal = 'left';
        /** @type {?} */
        var vertical = 'top';
        if (_left && _top) {
            // top left
            horizontal = 'left';
            vertical = 'top';
        }
        else if (_right && _bottom) {
            // bottom right
            left = right - this.width;
            top = bottom - this.height;
            horizontal = 'right';
            vertical = 'bottom';
        }
        else if (_right && _top) {
            // top right
            left = right - this.width;
            horizontal = 'right';
            vertical = 'top';
        }
        else if (_left && _bottom) {
            // bottom left
            top = bottom - this.height;
            horizontal = 'left';
            vertical = 'bottom';
        }
        return {
            top: top,
            left: left,
            bottom: bottom,
            right: right,
            targetHeight: targetHeight,
            targetWidth: targetWidth,
            horizontal: horizontal,
            vertical: vertical
        };
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getArrowTop = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        if (isVert) {
            return this._position.vertical === 'top'
                ? -1 * this.arrowHeight
                : this.height;
        }
        if (this.arrowPosition === 'center') {
            return this.height / 2 - this.arrowWidth / 2;
        }
        return this._position.vertical === 'top'
            ? this._position.targetHeight / 2 - this.arrowHeight / 2
            : this.height - this.arrowHeight / 2 - this._position.targetHeight / 2;
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getArrowLeft = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        if (isHorizontal) {
            return this._position.horizontal === 'left'
                ? -1 * this.arrowHeight
                : this.width;
        }
        if (this.arrowPosition === 'center') {
            return this.width / 2 - this.arrowHeight / 2;
        }
        return this._position.horizontal === 'left'
            ? this._position.targetWidth / 2 - this.arrowWidth / 2
            : this.width - this.arrowWidth / 2 - this._position.targetWidth / 2;
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getContainerTop = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        /** @type {?} */
        var isTop = this._position.vertical === 'top';
        /** @type {?} */
        var offset = 0;
        if (this.arrow && isTop) {
            offset -= this.getVerticalArrowOffset();
        }
        else if (this.arrow && !isTop) {
            offset += this.getVerticalArrowOffset();
        }
        if (!isVert) {
            return this._position.top + offset;
        }
        if (!this.overlaysTarget && isTop) {
            offset += this._position.targetHeight;
        }
        else if (!this.overlaysTarget && !isTop) {
            offset -= this._position.targetHeight;
        }
        if (this.arrow && isTop) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isTop) {
            offset -= this.arrowHeight;
        }
        return this._position.top + offset;
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getVerticalArrowOffset = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var offset = 0;
        /** @type {?} */
        var isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        if (this.arrowPosition === 'center' && isHorizontal) {
            offset += this.height / 2 - this._position.targetHeight / 2;
        }
        return offset;
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getHorizontalArrowOffset = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var offset = 0;
        /** @type {?} */
        var isVertical = ['above', 'auto', 'below'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        if (this.arrowPosition === 'center' && isVertical) {
            offset += this.width / 2 - this._position.targetWidth / 2;
        }
        return offset;
    };
    /**
     * @private
     * @return {?}
     */
    FivPopover.prototype.getContainerLeft = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return s === _this.position; }));
        /** @type {?} */
        var isLeft = this._position.horizontal === 'left';
        /** @type {?} */
        var offset = 0;
        if (this.arrow && isLeft) {
            offset -= this.getHorizontalArrowOffset();
        }
        else if (this.arrow && !isLeft) {
            offset += this.getHorizontalArrowOffset();
        }
        if (!isHorizontal) {
            return this._position.left + offset;
        }
        if (!this.overlaysTarget && isLeft) {
            offset += this._position.targetWidth;
        }
        else if (!this.overlaysTarget && !isLeft) {
            offset -= this._position.targetWidth;
        }
        if (this.arrow && isLeft) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isLeft) {
            offset -= this.arrowHeight;
        }
        return this._position.left + offset;
    };
    FivPopover.decorators = [
        { type: Component, args: [{
                    selector: 'fiv-popover',
                    template: "<fiv-overlay>\n  <div *ngIf=\"backdrop && !hidden\" [ngClass]=\"classes\" class=\"fiv-popover-backdrop\" (click)=\"close()\">\n  </div>\n  <div *ngIf=\"!hidden\" [ngClass]=\"classes\" class=\"popover-container\" [style]=\"styles\">\n    <div #animation *ngIf=\"overlay?.open\" class=\"animation-container\" anim [anim.in]=\"animationIn\">\n      <ng-content>\n      </ng-content>\n      <svg *ngIf=\"arrow && !overlaysTarget\" class=\"arrow\" [style]=\"svgStyles\">\n        <polygon [attr.points]=\"triangle\" />\n      </svg>\n    </div>\n\n  </div>\n\n</fiv-overlay>",
                    encapsulation: ViewEncapsulation.None,
                    styles: [":host{--fiv-popover-backdrop-color:rgba(0, 0, 0, 0.2)}.popover-container{position:absolute;display:block}.animation-container{height:100%;position:relative}svg.arrow{position:absolute;fill:var(--ion-item-background)}.fiv-popover-backdrop{position:absolute;display:block;width:100vw;height:100vh;background:var(--fiv-popover-backdrop-color)}"]
                }] }
    ];
    /** @nocollapse */
    FivPopover.ctorParameters = function () { return [
        { type: Platform },
        { type: IonContent, decorators: [{ type: Host }, { type: Optional }] },
        { type: DomSanitizer },
        { type: Router }
    ]; };
    FivPopover.propDecorators = {
        overlay: [{ type: ViewChild, args: [FivOverlay, { static: true },] }],
        animationContainer: [{ type: ViewChild, args: ['animation', { static: false },] }],
        width: [{ type: Input }],
        height: [{ type: Input }],
        arrow: [{ type: Input }],
        arrowWidth: [{ type: Input }],
        arrowHeight: [{ type: Input }],
        arrowPosition: [{ type: Input }],
        backdrop: [{ type: Input }],
        overlaysTarget: [{ type: Input }],
        closeOnNavigation: [{ type: Input }],
        scrollToTarget: [{ type: Input }],
        scrollSpeed: [{ type: Input }],
        position: [{ type: Input }],
        classes: [{ type: Input }],
        viewportOnly: [{ type: Input }],
        inDuration: [{ type: Input }],
        outDuration: [{ type: Input }],
        animationIn: [{ type: Input }],
        animationOut: [{ type: Input }]
    };
    return FivPopover;
}());
export { FivPopover };
if (false) {
    /** @type {?} */
    FivPopover.prototype.overlay;
    /** @type {?} */
    FivPopover.prototype.animationContainer;
    /** @type {?} */
    FivPopover.prototype.width;
    /** @type {?} */
    FivPopover.prototype.height;
    /** @type {?} */
    FivPopover.prototype.arrow;
    /** @type {?} */
    FivPopover.prototype.arrowWidth;
    /** @type {?} */
    FivPopover.prototype.arrowHeight;
    /** @type {?} */
    FivPopover.prototype.arrowPosition;
    /** @type {?} */
    FivPopover.prototype.backdrop;
    /** @type {?} */
    FivPopover.prototype.overlaysTarget;
    /** @type {?} */
    FivPopover.prototype.closeOnNavigation;
    /** @type {?} */
    FivPopover.prototype.scrollToTarget;
    /** @type {?} */
    FivPopover.prototype.scrollSpeed;
    /** @type {?} */
    FivPopover.prototype.position;
    /** @type {?} */
    FivPopover.prototype.classes;
    /** @type {?} */
    FivPopover.prototype.viewportOnly;
    /** @type {?} */
    FivPopover.prototype._position;
    /** @type {?} */
    FivPopover.prototype.hidden;
    /** @type {?} */
    FivPopover.prototype.onDestroy$;
    /** @type {?} */
    FivPopover.prototype.onClose$;
    /** @type {?} */
    FivPopover.prototype.inDuration;
    /** @type {?} */
    FivPopover.prototype.outDuration;
    /** @type {?} */
    FivPopover.prototype.animationIn;
    /** @type {?} */
    FivPopover.prototype.animationOut;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.content;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.dom;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvcG9wb3Zlci9wb3BvdmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQ0wsU0FBUyxFQUVULFNBQVMsRUFDVCxLQUFLLEVBQ0wsaUJBQWlCLEVBQ2pCLElBQUksRUFDSixRQUFRLEVBRVIsVUFBVSxFQUVYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUNMLEdBQUcsRUFDSCxTQUFTLEVBQ1QsR0FBRyxFQUNILFlBQVksRUFDWixNQUFNLEVBQ04sT0FBTyxFQUNSLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQVExRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFdkQ7SUEyRkUsb0JBQ1UsUUFBa0IsRUFDRSxPQUFtQixFQUN2QyxHQUFpQixFQUNqQixNQUFjO1FBSnhCLGlCQUtJO1FBSk0sYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNFLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDdkMsUUFBRyxHQUFILEdBQUcsQ0FBYztRQUNqQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBbkZmLFVBQUssR0FBRyxLQUFLLENBQUM7UUFDZCxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLGdCQUFXLEdBQVcsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7UUFDNUMsa0JBQWEsR0FBNEIsTUFBTSxDQUFDO1FBQ2hELGFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFDdEIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLGdCQUFXLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLGFBQVEsR0FBdUIsTUFBTSxDQUFDO1FBQ3RDLFlBQU8sR0FBYSxFQUFFLENBQUM7UUFDdkIsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFHN0IsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzNCLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRWhCLGVBQVUsR0FBRyxHQUFHLENBQUM7UUFDakIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsZ0JBQVc7Ozs7UUFBRyxVQUFDLE9BQW1CO1lBQ3pDLE9BQUEsTUFBTSxDQUFDLE9BQU8sRUFBRSxLQUFJLENBQUMsU0FBUyxFQUFFLEtBQUksQ0FBQyxVQUFVLENBQUM7UUFBaEQsQ0FBZ0QsRUFBQztRQUMxQyxpQkFBWTs7OztRQUFHLFVBQUMsT0FBbUI7WUFDMUMsT0FBQSxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUksQ0FBQyxXQUFXLENBQUM7UUFBbEMsQ0FBa0MsRUFBQztJQTZEbEMsQ0FBQztJQTNESixzQkFBSSw4QkFBTTs7OztRQUFWO1lBQ0UsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7Z0JBQ25CLE9BQU87YUFDUjtZQUNELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FDdEMsY0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSw4QkFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sMkJBQzNDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSwyQkFDeEIsSUFBSSxDQUFDLGVBQWUsRUFBRSxRQUFLLENBQ3JDLENBQUM7UUFDSixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLGdDQUFROzs7O1FBQVo7WUFBQSxpQkFVQzs7Z0JBVE8sWUFBWSxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUk7Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsS0FBSyxLQUFJLENBQUMsUUFBUSxFQUFuQixDQUFtQixFQUFDO1lBQ3JFLElBQUksWUFBWSxFQUFFO2dCQUNoQixPQUFVLElBQUksQ0FBQyxXQUFXLGFBQVEsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLFNBQ25ELElBQUksQ0FBQyxXQUFXLFNBQ2QsSUFBSSxDQUFDLFVBQVksQ0FBQzthQUN2QjtZQUNELE9BQU8sT0FBSyxJQUFJLENBQUMsV0FBVyxTQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxXQUFNLElBQUksQ0FBQyxVQUFVLFNBQ3RFLElBQUksQ0FBQyxXQUNMLENBQUM7UUFDTCxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLGlDQUFTOzs7O1FBQWI7WUFBQSxpQkFlQztZQWRDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO2dCQUNuQixPQUFPO2FBQ1I7O2dCQUNLLFlBQVksR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1lBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEtBQUssS0FBSSxDQUFDLFFBQVEsRUFBbkIsQ0FBbUIsRUFBQzs7Z0JBQy9ELE1BQU0sR0FDVixDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQztnQkFDbEUsSUFBSSxDQUFDLFFBQVEsS0FBSyxNQUFNO1lBQzFCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FDdEMsY0FBVyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLDZCQUNuRCxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLDBCQUNuRCxJQUFJLENBQUMsV0FBVyxFQUFFLDBCQUNqQixJQUFJLENBQUMsWUFBWSxFQUFFLHVDQUNOLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQU8sQ0FDN0MsQ0FBQztRQUNKLENBQUM7OztPQUFBO0lBRUQsc0JBQUksdUNBQWU7Ozs7UUFBbkI7WUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtnQkFDbkIsT0FBTzthQUNSO1lBQ0QsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUN0QyxhQUFXLElBQUksQ0FBQyxXQUFXLDJCQUNsQixJQUFJLENBQUMsVUFBVSx5QkFDakIsSUFBSSxDQUFDLFdBQVcsRUFBRSwwQkFDakIsSUFBSSxDQUFDLFlBQVksRUFBRSx1Q0FDTixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFPLENBQzNFLENBQUM7UUFDSixDQUFDOzs7T0FBQTs7OztJQVNELDZCQUFROzs7SUFBUjtRQUFBLGlCQVNDO1FBUkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2FBQ2YsSUFBSSxDQUNILE1BQU07Ozs7UUFBa0IsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLFlBQVksZUFBZSxFQUFoQyxDQUFnQyxFQUFDLEVBQ2xFLE1BQU07OztRQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsaUJBQWlCLElBQUksS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQTNDLENBQTJDLEVBQUMsRUFDekQsR0FBRzs7O1FBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxLQUFLLEVBQUUsRUFBWixDQUFZLEVBQUMsRUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDM0I7YUFDQSxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7O0lBRUQsb0NBQWU7OztJQUFmLGNBQXlCLENBQUM7Ozs7SUFFMUIsZ0NBQVc7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDOzs7O0lBRUQsMEJBQUs7OztJQUFMO1FBQUEsaUJBU0M7UUFSQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQzthQUN2QyxJQUFJLENBQ0gsS0FBSzs7O1FBQUM7WUFDSixLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3BCLEtBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkIsQ0FBQyxFQUFDLENBQ0g7YUFDQSxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7Ozs7SUFFTyx3Q0FBbUI7Ozs7O0lBQTNCLFVBQTRCLE1BQW1COztZQUN2QyxJQUFJLEdBQUcsTUFBTSxDQUFDLHFCQUFxQixFQUFFO1FBQzNDLE9BQU8sSUFBSSxDQUFDLHFCQUFxQixDQUMvQixJQUFJLENBQUMsR0FBRyxFQUNSLElBQUksQ0FBQyxJQUFJLEVBQ1QsSUFBSSxDQUFDLE1BQU0sRUFDWCxJQUFJLENBQUMsS0FBSyxFQUNWLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLEtBQUssQ0FDWCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFRCx5QkFBSTs7OztJQUFKLFVBQUssTUFBK0I7O1lBQzlCLE9BQU87UUFDWCxJQUFJLE1BQU0sWUFBWSxVQUFVLEVBQUU7WUFDaEMsT0FBTyxHQUFHLG1CQUFBLE1BQU0sQ0FBQyxNQUFNLEVBQWUsQ0FBQztTQUN4QzthQUFNLElBQUksTUFBTSxZQUFZLFVBQVUsRUFBRTtZQUN2QyxPQUFPLEdBQUcsbUJBQUEsTUFBTSxDQUFDLGFBQWEsRUFBZSxDQUFDO1NBQy9DO2FBQU07WUFDTCxPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBRUQsK0JBQVU7Ozs7SUFBVixVQUFXLE1BQW1COztZQUN0QixRQUFRLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQztRQUNqRCxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7Ozs7O0lBRU8sZ0NBQVc7Ozs7O0lBQW5CLFVBQW9CLE1BQW1CO1FBQXZDLGlCQWFDO1FBWkMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdEIsT0FBTztTQUNSO1FBQ0QsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUM7YUFDeEIsSUFBSSxDQUNILE9BQU87OztRQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEVBQTdCLENBQTZCLEVBQUMsRUFDNUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxFQUNoQixHQUFHOzs7UUFBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxFQUFoQyxDQUFnQyxFQUFDLEVBQzNDLEdBQUc7Ozs7UUFBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLENBQUMsS0FBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsRUFBdEIsQ0FBc0IsRUFBQyxFQUNsQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUMzQjthQUNBLFNBQVMsRUFBRSxDQUFDO0lBQ2pCLENBQUM7Ozs7OztJQUVPLGdDQUFXOzs7OztJQUFuQixVQUFvQixNQUFtQjtRQUF2QyxpQkFtQkM7UUFsQkMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdEIsT0FBTztTQUNSO1FBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDakMsS0FBSyxDQUNILFNBQVMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLEVBQy9CLFNBQVMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLEVBQzlCLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUN2QjtpQkFDRSxJQUFJLENBQ0gsT0FBTzs7O1lBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsRUFBN0IsQ0FBNkIsRUFBQyxFQUM1QyxHQUFHOzs7WUFBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxFQUFoQyxDQUFnQyxFQUFDLEVBQzNDLEdBQUc7Ozs7WUFBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLENBQUMsS0FBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsRUFBdEIsQ0FBc0IsRUFBQyxFQUNsQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUMzQjtpQkFDQSxTQUFTLEVBQUUsQ0FBQztTQUNoQjtJQUNILENBQUM7Ozs7OztJQUVPLHFDQUFnQjs7Ozs7SUFBeEIsVUFBeUIsTUFBbUI7UUFBNUMsaUJBT0M7UUFOQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQy9ELEdBQUc7Ozs7UUFBQyxVQUFBLFVBQVU7WUFDWixPQUFBLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFBMUQsQ0FBMEQsRUFDM0QsRUFDRCxNQUFNOzs7O1FBQUMsVUFBQSxVQUFVLElBQUksT0FBQSxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxVQUFVLEVBQS9CLENBQStCLEVBQUMsQ0FDdEQsQ0FBQztJQUNKLENBQUM7Ozs7Ozs7SUFFYSxtQ0FBYzs7Ozs7O0lBQTVCLFVBQTZCLE1BQW1CLEVBQUUsUUFBeUI7Ozs7NEJBQ3pFLHFCQUFNLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLEVBQUE7O3dCQUE3QyxTQUE2QyxDQUFDO3dCQUM5QyxJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQzt3QkFDMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7Ozs7S0FDckI7Ozs7Ozs7SUFFYSxxQ0FBZ0I7Ozs7OztJQUE5QixVQUNFLE1BQW1CLEVBQ25CLFFBQXlCOzs7Ozs7NkJBRXJCLENBQUEsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFBLEVBQW5DLHdCQUFtQzt3QkFDaEIscUJBQU0sSUFBSSxDQUFDLFVBQVUsQ0FDeEMsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQy9CLEVBQUE7O3dCQUZLLFlBQVksR0FBRyxTQUVwQjt3QkFDRCxJQUFJLFlBQVksRUFBRTs0QkFDaEIsc0JBQU87eUJBQ1I7d0JBQ0QscUJBQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQzlCLFFBQVEsQ0FBQyxJQUFJLEVBQ2IsUUFBUSxDQUFDLEdBQUcsRUFDWixJQUFJLENBQUMsV0FBVyxDQUNqQixFQUFBOzt3QkFKRCxTQUlDLENBQUM7Ozs7OztLQUVMOzs7OztJQUNLLCtCQUFVOzs7O0lBQWhCLFVBQWlCLFFBQThCOzs7O2dCQUN2QyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUU7Z0JBQy9CLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRTtnQkFFbkMsc0JBQU8sQ0FDTCxRQUFRLENBQUMsR0FBRyxJQUFJLE1BQU07d0JBQ3RCLFFBQVEsQ0FBQyxNQUFNLElBQUksQ0FBQzt3QkFDcEIsUUFBUSxDQUFDLElBQUksR0FBRyxLQUFLO3dCQUNyQixRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FDbkIsRUFBQzs7O0tBQ0g7Ozs7Ozs7Ozs7O0lBRU8sMENBQXFCOzs7Ozs7Ozs7O0lBQTdCLFVBQ0UsR0FBVyxFQUNYLElBQVksRUFDWixNQUFjLEVBQ2QsS0FBYSxFQUNiLFlBQW9CLEVBQ3BCLFdBQW1COzs7WUFHYixLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUU7O1lBQzdCLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTs7WUFFL0IsS0FBSyxHQUNULElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTztZQUN6QixDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssTUFBTSxDQUFDOztZQUMxQyxNQUFNLEdBQ1YsSUFBSSxDQUFDLFFBQVEsS0FBSyxNQUFNO1lBQ3hCLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7O1lBQzVDLElBQUksR0FDUixJQUFJLENBQUMsUUFBUSxLQUFLLE9BQU87WUFDekIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQzs7WUFDM0MsT0FBTyxHQUNYLElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTztZQUN6QixDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDOzs7WUFHOUMsVUFBVSxHQUEyQixNQUFNOztZQUMzQyxRQUFRLEdBQXlCLEtBQUs7UUFFMUMsSUFBSSxLQUFLLElBQUksSUFBSSxFQUFFO1lBQ2pCLFdBQVc7WUFDWCxVQUFVLEdBQUcsTUFBTSxDQUFDO1lBQ3BCLFFBQVEsR0FBRyxLQUFLLENBQUM7U0FDbEI7YUFBTSxJQUFJLE1BQU0sSUFBSSxPQUFPLEVBQUU7WUFDNUIsZUFBZTtZQUNmLElBQUksR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMxQixHQUFHLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDM0IsVUFBVSxHQUFHLE9BQU8sQ0FBQztZQUNyQixRQUFRLEdBQUcsUUFBUSxDQUFDO1NBQ3JCO2FBQU0sSUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO1lBQ3pCLFlBQVk7WUFDWixJQUFJLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDMUIsVUFBVSxHQUFHLE9BQU8sQ0FBQztZQUNyQixRQUFRLEdBQUcsS0FBSyxDQUFDO1NBQ2xCO2FBQU0sSUFBSSxLQUFLLElBQUksT0FBTyxFQUFFO1lBQzNCLGNBQWM7WUFDZCxHQUFHLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDM0IsVUFBVSxHQUFHLE1BQU0sQ0FBQztZQUNwQixRQUFRLEdBQUcsUUFBUSxDQUFDO1NBQ3JCO1FBRUQsT0FBTztZQUNMLEdBQUcsS0FBQTtZQUNILElBQUksTUFBQTtZQUNKLE1BQU0sUUFBQTtZQUNOLEtBQUssT0FBQTtZQUNMLFlBQVksY0FBQTtZQUNaLFdBQVcsYUFBQTtZQUNYLFVBQVUsWUFBQTtZQUNWLFFBQVEsVUFBQTtTQUNULENBQUM7SUFDSixDQUFDOzs7OztJQUVPLGdDQUFXOzs7O0lBQW5CO1FBQUEsaUJBYUM7O1lBWk8sTUFBTSxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEtBQUssS0FBSSxDQUFDLFFBQVEsRUFBbkIsQ0FBbUIsRUFBQztRQUN4RSxJQUFJLE1BQU0sRUFBRTtZQUNWLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEtBQUssS0FBSztnQkFDdEMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXO2dCQUN2QixDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUNqQjtRQUNELElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxRQUFRLEVBQUU7WUFDbkMsT0FBTyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztTQUM5QztRQUNELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEtBQUssS0FBSztZQUN0QyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQztZQUN4RCxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7SUFDM0UsQ0FBQzs7Ozs7SUFFTyxpQ0FBWTs7OztJQUFwQjtRQUFBLGlCQWFDOztZQVpPLFlBQVksR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLEtBQUssS0FBSSxDQUFDLFFBQVEsRUFBbkIsQ0FBbUIsRUFBQztRQUNyRSxJQUFJLFlBQVksRUFBRTtZQUNoQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxLQUFLLE1BQU07Z0JBQ3pDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVztnQkFDdkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7U0FDaEI7UUFDRCxJQUFJLElBQUksQ0FBQyxhQUFhLEtBQUssUUFBUSxFQUFFO1lBQ25DLE9BQU8sSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7U0FDOUM7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxLQUFLLE1BQU07WUFDekMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUM7WUFDdEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7Ozs7O0lBRU8sb0NBQWU7Ozs7SUFBdkI7UUFBQSxpQkF5QkM7O1lBeEJPLE1BQU0sR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxLQUFLLEtBQUksQ0FBQyxRQUFRLEVBQW5CLENBQW1CLEVBQUM7O1lBQ2xFLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsS0FBSyxLQUFLOztZQUUzQyxNQUFNLEdBQUcsQ0FBQztRQUNkLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxLQUFLLEVBQUU7WUFDdkIsTUFBTSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1NBQ3pDO2FBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQy9CLE1BQU0sSUFBSSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztTQUN6QztRQUNELElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQztTQUNwQztRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxJQUFJLEtBQUssRUFBRTtZQUNqQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUM7U0FDdkM7YUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUN6QyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUM7U0FDdkM7UUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksS0FBSyxFQUFFO1lBQ3ZCLE1BQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQzVCO2FBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQy9CLE1BQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQzVCO1FBQ0QsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUM7SUFDckMsQ0FBQzs7Ozs7SUFFTywyQ0FBc0I7Ozs7SUFBOUI7UUFBQSxpQkFPQzs7WUFOSyxNQUFNLEdBQUcsQ0FBQzs7WUFDUixZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxLQUFLLEtBQUksQ0FBQyxRQUFRLEVBQW5CLENBQW1CLEVBQUM7UUFDckUsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFFBQVEsSUFBSSxZQUFZLEVBQUU7WUFDbkQsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztTQUM3RDtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBQ08sNkNBQXdCOzs7O0lBQWhDO1FBQUEsaUJBU0M7O1lBUkssTUFBTSxHQUFHLENBQUM7O1lBQ1IsVUFBVSxHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1FBQ2hELFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxLQUFLLEtBQUksQ0FBQyxRQUFRLEVBQW5CLENBQW1CLEVBQ3pCO1FBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFFBQVEsSUFBSSxVQUFVLEVBQUU7WUFDakQsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztTQUMzRDtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRU8scUNBQWdCOzs7O0lBQXhCO1FBQUEsaUJBMEJDOztZQXpCTyxZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxLQUFLLEtBQUksQ0FBQyxRQUFRLEVBQW5CLENBQW1CLEVBQUM7O1lBQy9ELE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsS0FBSyxNQUFNOztZQUUvQyxNQUFNLEdBQUcsQ0FBQztRQUNkLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxNQUFNLEVBQUU7WUFDeEIsTUFBTSxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1NBQzNDO2FBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztTQUMzQztRQUVELElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDakIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7U0FDckM7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxNQUFNLEVBQUU7WUFDbEMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1NBQ3RDO2FBQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDMUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1NBQ3RDO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLE1BQU0sRUFBRTtZQUN4QixNQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUM1QjthQUFNLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQyxNQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUM1QjtRQUNELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDO0lBQ3RDLENBQUM7O2dCQW5aRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGFBQWE7b0JBQ3ZCLHFrQkFBdUM7b0JBRXZDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztpQkFDdEM7Ozs7Z0JBekJRLFFBQVE7Z0JBQUUsVUFBVSx1QkFpSHhCLElBQUksWUFBSSxRQUFRO2dCQS9IWixZQUFZO2dCQXdCSyxNQUFNOzs7MEJBaUI3QixTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtxQ0FDdEMsU0FBUyxTQUFDLFdBQVcsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7d0JBRXhDLEtBQUs7eUJBQ0wsS0FBSzt3QkFDTCxLQUFLOzZCQUNMLEtBQUs7OEJBQ0wsS0FBSztnQ0FDTCxLQUFLOzJCQUNMLEtBQUs7aUNBQ0wsS0FBSztvQ0FDTCxLQUFLO2lDQUNMLEtBQUs7OEJBQ0wsS0FBSzsyQkFDTCxLQUFLOzBCQUNMLEtBQUs7K0JBQ0wsS0FBSzs2QkFPTCxLQUFLOzhCQUNMLEtBQUs7OEJBQ0wsS0FBSzsrQkFFTCxLQUFLOztJQWtYUixpQkFBQztDQUFBLEFBcFpELElBb1pDO1NBOVlZLFVBQVU7OztJQUNyQiw2QkFBNkQ7O0lBQzdELHdDQUEwRTs7SUFFMUUsMkJBQXVCOztJQUN2Qiw0QkFBd0I7O0lBQ3hCLDJCQUF1Qjs7SUFDdkIsZ0NBQXlCOztJQUN6QixpQ0FBcUQ7O0lBQ3JELG1DQUF5RDs7SUFDekQsOEJBQXlCOztJQUN6QixvQ0FBK0I7O0lBQy9CLHVDQUFrQzs7SUFDbEMsb0NBQWdDOztJQUNoQyxpQ0FBMkI7O0lBQzNCLDhCQUErQzs7SUFDL0MsNkJBQWdDOztJQUNoQyxrQ0FBNkI7O0lBRTdCLCtCQUEyQjs7SUFDM0IsNEJBQWU7O0lBQ2YsZ0NBQTJCOztJQUMzQiw4QkFBeUI7O0lBRXpCLGdDQUEwQjs7SUFDMUIsaUNBQTBCOztJQUMxQixpQ0FDbUQ7O0lBQ25ELGtDQUNxQzs7Ozs7SUF5RG5DLDhCQUEwQjs7Ozs7SUFDMUIsNkJBQStDOzs7OztJQUMvQyx5QkFBeUI7Ozs7O0lBQ3pCLDRCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuaW1JbiwgYW5pbU91dCB9IGZyb20gJy4vcG9wb3Zlci5hbmltYXRpb25zJztcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIFZpZXdDaGlsZCxcbiAgSW5wdXQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBIb3N0LFxuICBPcHRpb25hbCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRml2T3ZlcmxheSB9IGZyb20gJy4uL292ZXJsYXkvb3ZlcmxheS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUGxhdGZvcm0sIElvbkNvbnRlbnQgfSBmcm9tICdAaW9uaWMvYW5ndWxhcic7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIFN1YmplY3QsIG1lcmdlLCBmcm9tIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge1xuICB0YXAsXG4gIHRha2VVbnRpbCxcbiAgbWFwLFxuICB0aHJvdHRsZVRpbWUsXG4gIGZpbHRlcixcbiAgZmxhdE1hcFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uU3RhcnQsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQge1xuICBQb3BvdmVyUG9zaXRpb25pbmcsXG4gIFBvcG92ZXJQb3NpdGlvbixcbiAgUG9wb3Zlckhvcml6b250YWxBbGlnbixcbiAgUG9wb3ZlclZlcnRpY2FsQWxpZ24sXG4gIFBvcG92ZXJBcnJvd1Bvc2l0aW9uaW5nXG59IGZyb20gJy4vcG9wb3Zlci50eXBlcyc7XG5pbXBvcnQgeyBhZnRlciB9IGZyb20gJ0BmaXZldGhyZWUvbmd4LXJ4anMtYW5pbWF0aW9ucyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Zpdi1wb3BvdmVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvcG92ZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9wb3BvdmVyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgRml2UG9wb3ZlciBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZChGaXZPdmVybGF5LCB7IHN0YXRpYzogdHJ1ZSB9KSBvdmVybGF5OiBGaXZPdmVybGF5O1xuICBAVmlld0NoaWxkKCdhbmltYXRpb24nLCB7IHN0YXRpYzogZmFsc2UgfSkgYW5pbWF0aW9uQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICBASW5wdXQoKSBhcnJvdyA9IGZhbHNlO1xuICBASW5wdXQoKSBhcnJvd1dpZHRoID0gMjQ7XG4gIEBJbnB1dCgpIGFycm93SGVpZ2h0OiBudW1iZXIgPSB0aGlzLmFycm93V2lkdGggLyAxLjY7XG4gIEBJbnB1dCgpIGFycm93UG9zaXRpb246IFBvcG92ZXJBcnJvd1Bvc2l0aW9uaW5nID0gJ2F1dG8nO1xuICBASW5wdXQoKSBiYWNrZHJvcCA9IHRydWU7XG4gIEBJbnB1dCgpIG92ZXJsYXlzVGFyZ2V0ID0gdHJ1ZTtcbiAgQElucHV0KCkgY2xvc2VPbk5hdmlnYXRpb24gPSB0cnVlO1xuICBASW5wdXQoKSBzY3JvbGxUb1RhcmdldCA9IGZhbHNlO1xuICBASW5wdXQoKSBzY3JvbGxTcGVlZCA9IDEwMDtcbiAgQElucHV0KCkgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbmluZyA9ICdhdXRvJztcbiAgQElucHV0KCkgY2xhc3Nlczogc3RyaW5nW10gPSBbXTtcbiAgQElucHV0KCkgdmlld3BvcnRPbmx5ID0gdHJ1ZTtcblxuICBfcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbjtcbiAgaGlkZGVuID0gZmFsc2U7XG4gIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuICBvbkNsb3NlJCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgQElucHV0KCkgaW5EdXJhdGlvbiA9IDIwMDtcbiAgQElucHV0KCkgb3V0RHVyYXRpb24gPSA4MDtcbiAgQElucHV0KCkgYW5pbWF0aW9uSW4gPSAoZWxlbWVudDogRWxlbWVudFJlZikgPT5cbiAgICBhbmltSW4oZWxlbWVudCwgdGhpcy5fcG9zaXRpb24sIHRoaXMuaW5EdXJhdGlvbik7XG4gIEBJbnB1dCgpIGFuaW1hdGlvbk91dCA9IChlbGVtZW50OiBFbGVtZW50UmVmKSA9PlxuICAgIGFuaW1PdXQoZWxlbWVudCwgdGhpcy5vdXREdXJhdGlvbik7XG5cbiAgZ2V0IHN0eWxlcygpIHtcbiAgICBpZiAoIXRoaXMuX3Bvc2l0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmRvbS5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoXG4gICAgICBgIHdpZHRoOiAke3RoaXMud2lkdGggPyB0aGlzLndpZHRoICsgJ3B4JyA6ICdhdXRvJ307IFxuICAgICAgICBoZWlnaHQ6ICR7dGhpcy5oZWlnaHQgPyB0aGlzLmhlaWdodCArICdweCcgOiAnYXV0byd9OyBcbiAgICAgICAgbGVmdDogJHt0aGlzLmdldENvbnRhaW5lckxlZnQoKX1weDsgXG4gICAgICAgIHRvcDogJHt0aGlzLmdldENvbnRhaW5lclRvcCgpfXB4O2BcbiAgICApO1xuICB9XG5cbiAgZ2V0IHRyaWFuZ2xlKCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5hcnJvd0hlaWdodH0sMCAwLCR7dGhpcy5hcnJvd1dpZHRoIC8gMn0gJHtcbiAgICAgICAgdGhpcy5hcnJvd0hlaWdodFxuICAgICAgfSwke3RoaXMuYXJyb3dXaWR0aH1gO1xuICAgIH1cbiAgICByZXR1cm4gYDAsJHt0aGlzLmFycm93SGVpZ2h0fSAke3RoaXMuYXJyb3dXaWR0aCAvIDJ9LDAgJHt0aGlzLmFycm93V2lkdGh9LCR7XG4gICAgICB0aGlzLmFycm93SGVpZ2h0XG4gICAgfWA7XG4gIH1cblxuICBnZXQgc3ZnU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGNvbnN0IHJvdGF0ZSA9XG4gICAgICAodGhpcy5wb3NpdGlvbiA9PT0gJ2F1dG8nICYmIHRoaXMuX3Bvc2l0aW9uLnZlcnRpY2FsID09PSAnYm90dG9tJykgfHxcbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JztcbiAgICByZXR1cm4gdGhpcy5kb20uYnlwYXNzU2VjdXJpdHlUcnVzdFN0eWxlKFxuICAgICAgYGhlaWdodDogJHtpc0hvcml6b250YWwgPyB0aGlzLmFycm93V2lkdGggOiB0aGlzLmFycm93SGVpZ2h0fXB4OyBcbiAgICAgIHdpZHRoOiAke2lzSG9yaXpvbnRhbCA/IHRoaXMuYXJyb3dIZWlnaHQgOiB0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHtyb3RhdGUgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBnZXQgYW5pbWF0aW9uU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZG9tLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShcbiAgICAgIGBoZWlnaHQ6ICR7dGhpcy5hcnJvd0hlaWdodH1weDsgXG4gICAgICB3aWR0aDogJHt0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHt0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ2JvdHRvbScgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBsYXRmb3JtOiBQbGF0Zm9ybSxcbiAgICBASG9zdCgpIEBPcHRpb25hbCgpIHByaXZhdGUgY29udGVudDogSW9uQ29udGVudCxcbiAgICBwcml2YXRlIGRvbTogRG9tU2FuaXRpemVyLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucm91dGVyLmV2ZW50c1xuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcjxOYXZpZ2F0aW9uU3RhcnQ+KGV2ZW50ID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvblN0YXJ0KSxcbiAgICAgICAgZmlsdGVyKCgpID0+IHRoaXMuY2xvc2VPbk5hdmlnYXRpb24gJiYgdGhpcy5vdmVybGF5Lm9wZW4pLFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5jbG9zZSgpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHt9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuYW5pbWF0aW9uT3V0KHRoaXMuYW5pbWF0aW9uQ29udGFpbmVyKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGFmdGVyKCgpID0+IHtcbiAgICAgICAgICB0aGlzLm92ZXJsYXkuaGlkZSgpO1xuICAgICAgICAgIHRoaXMub25DbG9zZSQubmV4dCgpO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB0aGlzLmNhbGN1bGNhdGVQb3NpdGlvbmluZyhcbiAgICAgIHJlY3QudG9wLFxuICAgICAgcmVjdC5sZWZ0LFxuICAgICAgcmVjdC5ib3R0b20sXG4gICAgICByZWN0LnJpZ2h0LFxuICAgICAgcmVjdC5oZWlnaHQsXG4gICAgICByZWN0LndpZHRoXG4gICAgKTtcbiAgfVxuXG4gIG9wZW4odGFyZ2V0OiBNb3VzZUV2ZW50IHwgRWxlbWVudFJlZikge1xuICAgIGxldCBlbGVtZW50O1xuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSB7XG4gICAgICBlbGVtZW50ID0gdGFyZ2V0LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYpIHtcbiAgICAgIGVsZW1lbnQgPSB0YXJnZXQubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wZW5UYXJnZXQoZWxlbWVudCk7XG4gIH1cblxuICBvcGVuVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0UG9zaXRpb25PZlRhcmdldCh0YXJnZXQpO1xuICAgIHRoaXMub3BlbkF0UG9zaXRpb24odGFyZ2V0LCBwb3NpdGlvbik7XG4gICAgdGhpcy53YXRjaFJlc2l6ZSh0YXJnZXQpO1xuICAgIHRoaXMud2F0Y2hTY3JvbGwodGFyZ2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgd2F0Y2hSZXNpemUodGFyZ2V0OiBIVE1MRWxlbWVudCkge1xuICAgIGlmICghdGhpcy52aWV3cG9ydE9ubHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZnJvbUV2ZW50KHdpbmRvdywgJ3Jlc2l6ZScpXG4gICAgICAucGlwZShcbiAgICAgICAgZmxhdE1hcCgoKSA9PiB0aGlzLmZpbHRlckluVmlld3BvcnQodGFyZ2V0KSksXG4gICAgICAgIHRocm90dGxlVGltZSg1MCksXG4gICAgICAgIG1hcCgoKSA9PiB0aGlzLmdldFBvc2l0aW9uT2ZUYXJnZXQodGFyZ2V0KSksXG4gICAgICAgIHRhcChwb3MgPT4gKHRoaXMuX3Bvc2l0aW9uID0gcG9zKSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIHdhdGNoU2Nyb2xsKHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoIXRoaXMudmlld3BvcnRPbmx5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbnRlbnQgJiYgIXRoaXMuYmFja2Ryb3ApIHtcbiAgICAgIHRoaXMuY29udGVudC5zY3JvbGxFdmVudHMgPSB0cnVlO1xuICAgICAgbWVyZ2UoXG4gICAgICAgIGZyb21FdmVudCh3aW5kb3csICdtb3VzZXdoZWVsJyksXG4gICAgICAgIGZyb21FdmVudCh3aW5kb3csICd0b3VjaG1vdmUnKSxcbiAgICAgICAgdGhpcy5jb250ZW50LmlvblNjcm9sbFxuICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBmbGF0TWFwKCgpID0+IHRoaXMuZmlsdGVySW5WaWV3cG9ydCh0YXJnZXQpKSxcbiAgICAgICAgICBtYXAoKCkgPT4gdGhpcy5nZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldCkpLFxuICAgICAgICAgIHRhcChwb3MgPT4gKHRoaXMuX3Bvc2l0aW9uID0gcG9zKSksXG4gICAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJJblZpZXdwb3J0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICByZXR1cm4gZnJvbSh0aGlzLmluVmlld3BvcnQodGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKSkucGlwZShcbiAgICAgIHRhcChpblZpZXdwb3J0ID0+XG4gICAgICAgICFpblZpZXdwb3J0ID8gKHRoaXMuaGlkZGVuID0gdHJ1ZSkgOiAodGhpcy5oaWRkZW4gPSBmYWxzZSlcbiAgICAgICksXG4gICAgICBmaWx0ZXIoaW5WaWV3UG9ydCA9PiB0aGlzLm92ZXJsYXkub3BlbiAmJiBpblZpZXdQb3J0KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG9wZW5BdFBvc2l0aW9uKHRhcmdldDogSFRNTEVsZW1lbnQsIHBvc2l0aW9uOiBQb3BvdmVyUG9zaXRpb24pIHtcbiAgICBhd2FpdCB0aGlzLnNjcm9sbFRvUG9zaXRpb24odGFyZ2V0LCBwb3NpdGlvbik7XG4gICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB0aGlzLm92ZXJsYXkuc2hvdygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzY3JvbGxUb1Bvc2l0aW9uKFxuICAgIHRhcmdldDogSFRNTEVsZW1lbnQsXG4gICAgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvblxuICApIHtcbiAgICBpZiAodGhpcy5jb250ZW50ICYmIHRoaXMuc2Nyb2xsVG9UYXJnZXQpIHtcbiAgICAgIGNvbnN0IGlzSW5WaWV3cG9ydCA9IGF3YWl0IHRoaXMuaW5WaWV3cG9ydChcbiAgICAgICAgdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICApO1xuICAgICAgaWYgKGlzSW5WaWV3cG9ydCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhd2FpdCB0aGlzLmNvbnRlbnQuc2Nyb2xsVG9Qb2ludChcbiAgICAgICAgcG9zaXRpb24ubGVmdCxcbiAgICAgICAgcG9zaXRpb24udG9wLFxuICAgICAgICB0aGlzLnNjcm9sbFNwZWVkXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBhc3luYyBpblZpZXdwb3J0KHBvc2l0aW9uOiBET01SZWN0IHwgQ2xpZW50UmVjdCkge1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMucGxhdGZvcm0uaGVpZ2h0KCk7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLnBsYXRmb3JtLndpZHRoKCk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgcG9zaXRpb24udG9wIDw9IGhlaWdodCAmJlxuICAgICAgcG9zaXRpb24uYm90dG9tID49IDAgJiZcbiAgICAgIHBvc2l0aW9uLmxlZnQgPCB3aWR0aCAmJlxuICAgICAgcG9zaXRpb24ucmlnaHQgPiAwXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsY2F0ZVBvc2l0aW9uaW5nKFxuICAgIHRvcDogbnVtYmVyLFxuICAgIGxlZnQ6IG51bWJlcixcbiAgICBib3R0b206IG51bWJlcixcbiAgICByaWdodDogbnVtYmVyLFxuICAgIHRhcmdldEhlaWdodDogbnVtYmVyLFxuICAgIHRhcmdldFdpZHRoOiBudW1iZXJcbiAgKTogUG9wb3ZlclBvc2l0aW9uIHtcbiAgICAvLyBjYWxjdWxhdGVzIHRoZSBwb3NpdGlvbiBvZiB0aGUgcG9wb3ZlciB3aXRob3V0IGNvbnNpZGVyaW5nIGFycm93IGFuZCBvdmVybGF5IG9mZnNldFxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5wbGF0Zm9ybS53aWR0aCgpO1xuICAgIGNvbnN0IGhlaWdodCA9IHRoaXMucGxhdGZvcm0uaGVpZ2h0KCk7XG5cbiAgICBjb25zdCBfbGVmdCA9XG4gICAgICB0aGlzLnBvc2l0aW9uID09PSAncmlnaHQnIHx8XG4gICAgICAod2lkdGggLyAyID4gbGVmdCAmJiB0aGlzLnBvc2l0aW9uICE9PSAnbGVmdCcpO1xuICAgIGNvbnN0IF9yaWdodCA9XG4gICAgICB0aGlzLnBvc2l0aW9uID09PSAnbGVmdCcgfHxcbiAgICAgICh3aWR0aCAvIDIgPD0gbGVmdCAmJiB0aGlzLnBvc2l0aW9uICE9PSAncmlnaHQnKTtcbiAgICBjb25zdCBfdG9wID1cbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdiZWxvdycgfHxcbiAgICAgIChoZWlnaHQgLyAyID4gdG9wICYmIHRoaXMucG9zaXRpb24gIT09ICdhYm92ZScpO1xuICAgIGNvbnN0IF9ib3R0b20gPVxuICAgICAgdGhpcy5wb3NpdGlvbiA9PT0gJ2Fib3ZlJyB8fFxuICAgICAgKGhlaWdodCAvIDIgPD0gdG9wICYmIHRoaXMucG9zaXRpb24gIT09ICdiZWxvdycpO1xuXG4gICAgLy8gdHJhbnNmb3JtIG9yaWdpblxuICAgIGxldCBob3Jpem9udGFsOiBQb3BvdmVySG9yaXpvbnRhbEFsaWduID0gJ2xlZnQnO1xuICAgIGxldCB2ZXJ0aWNhbDogUG9wb3ZlclZlcnRpY2FsQWxpZ24gPSAndG9wJztcblxuICAgIGlmIChfbGVmdCAmJiBfdG9wKSB7XG4gICAgICAvLyB0b3AgbGVmdFxuICAgICAgaG9yaXpvbnRhbCA9ICdsZWZ0JztcbiAgICAgIHZlcnRpY2FsID0gJ3RvcCc7XG4gICAgfSBlbHNlIGlmIChfcmlnaHQgJiYgX2JvdHRvbSkge1xuICAgICAgLy8gYm90dG9tIHJpZ2h0XG4gICAgICBsZWZ0ID0gcmlnaHQgLSB0aGlzLndpZHRoO1xuICAgICAgdG9wID0gYm90dG9tIC0gdGhpcy5oZWlnaHQ7XG4gICAgICBob3Jpem9udGFsID0gJ3JpZ2h0JztcbiAgICAgIHZlcnRpY2FsID0gJ2JvdHRvbSc7XG4gICAgfSBlbHNlIGlmIChfcmlnaHQgJiYgX3RvcCkge1xuICAgICAgLy8gdG9wIHJpZ2h0XG4gICAgICBsZWZ0ID0gcmlnaHQgLSB0aGlzLndpZHRoO1xuICAgICAgaG9yaXpvbnRhbCA9ICdyaWdodCc7XG4gICAgICB2ZXJ0aWNhbCA9ICd0b3AnO1xuICAgIH0gZWxzZSBpZiAoX2xlZnQgJiYgX2JvdHRvbSkge1xuICAgICAgLy8gYm90dG9tIGxlZnRcbiAgICAgIHRvcCA9IGJvdHRvbSAtIHRoaXMuaGVpZ2h0O1xuICAgICAgaG9yaXpvbnRhbCA9ICdsZWZ0JztcbiAgICAgIHZlcnRpY2FsID0gJ2JvdHRvbSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcCxcbiAgICAgIGxlZnQsXG4gICAgICBib3R0b20sXG4gICAgICByaWdodCxcbiAgICAgIHRhcmdldEhlaWdodCxcbiAgICAgIHRhcmdldFdpZHRoLFxuICAgICAgaG9yaXpvbnRhbCxcbiAgICAgIHZlcnRpY2FsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJyb3dUb3AoKSB7XG4gICAgY29uc3QgaXNWZXJ0ID0gWydhdXRvJywgJ2JlbG93JywgJ2Fib3ZlJ10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGlmIChpc1ZlcnQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ3RvcCdcbiAgICAgICAgPyAtMSAqIHRoaXMuYXJyb3dIZWlnaHRcbiAgICAgICAgOiB0aGlzLmhlaWdodDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlaWdodCAvIDIgLSB0aGlzLmFycm93V2lkdGggLyAyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24udmVydGljYWwgPT09ICd0b3AnXG4gICAgICA/IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodCAvIDIgLSB0aGlzLmFycm93SGVpZ2h0IC8gMlxuICAgICAgOiB0aGlzLmhlaWdodCAtIHRoaXMuYXJyb3dIZWlnaHQgLyAyIC0gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0IC8gMjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJyb3dMZWZ0KCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnXG4gICAgICAgID8gLTEgKiB0aGlzLmFycm93SGVpZ2h0XG4gICAgICAgIDogdGhpcy53aWR0aDtcbiAgICB9XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiB0aGlzLndpZHRoIC8gMiAtIHRoaXMuYXJyb3dIZWlnaHQgLyAyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnXG4gICAgICA/IHRoaXMuX3Bvc2l0aW9uLnRhcmdldFdpZHRoIC8gMiAtIHRoaXMuYXJyb3dXaWR0aCAvIDJcbiAgICAgIDogdGhpcy53aWR0aCAtIHRoaXMuYXJyb3dXaWR0aCAvIDIgLSB0aGlzLl9wb3NpdGlvbi50YXJnZXRXaWR0aCAvIDI7XG4gIH1cblxuICBwcml2YXRlIGdldENvbnRhaW5lclRvcCgpIHtcbiAgICBjb25zdCBpc1ZlcnQgPSBbJ2F1dG8nLCAnYmVsb3cnLCAnYWJvdmUnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgY29uc3QgaXNUb3AgPSB0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ3RvcCc7XG5cbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuZ2V0VmVydGljYWxBcnJvd09mZnNldCgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hcnJvdyAmJiAhaXNUb3ApIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLmdldFZlcnRpY2FsQXJyb3dPZmZzZXQoKTtcbiAgICB9XG4gICAgaWYgKCFpc1ZlcnQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi50b3AgKyBvZmZzZXQ7XG4gICAgfVxuICAgIGlmICghdGhpcy5vdmVybGF5c1RhcmdldCAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodDtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm92ZXJsYXlzVGFyZ2V0ICYmICFpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc1RvcCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfSBlbHNlIGlmICh0aGlzLmFycm93ICYmICFpc1RvcCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi50b3AgKyBvZmZzZXQ7XG4gIH1cblxuICBwcml2YXRlIGdldFZlcnRpY2FsQXJyb3dPZmZzZXQoKSB7XG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGlmICh0aGlzLmFycm93UG9zaXRpb24gPT09ICdjZW50ZXInICYmIGlzSG9yaXpvbnRhbCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuaGVpZ2h0IC8gMiAtIHRoaXMuX3Bvc2l0aW9uLnRhcmdldEhlaWdodCAvIDI7XG4gICAgfVxuICAgIHJldHVybiBvZmZzZXQ7XG4gIH1cbiAgcHJpdmF0ZSBnZXRIb3Jpem9udGFsQXJyb3dPZmZzZXQoKSB7XG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgY29uc3QgaXNWZXJ0aWNhbCA9IFsnYWJvdmUnLCAnYXV0bycsICdiZWxvdyddLnNvbWUoXG4gICAgICBzID0+IHMgPT09IHRoaXMucG9zaXRpb25cbiAgICApO1xuICAgIGlmICh0aGlzLmFycm93UG9zaXRpb24gPT09ICdjZW50ZXInICYmIGlzVmVydGljYWwpIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLndpZHRoIC8gMiAtIHRoaXMuX3Bvc2l0aW9uLnRhcmdldFdpZHRoIC8gMjtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGFpbmVyTGVmdCgpIHtcbiAgICBjb25zdCBpc0hvcml6b250YWwgPSBbJ2xlZnQnLCAncmlnaHQnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgY29uc3QgaXNMZWZ0ID0gdGhpcy5fcG9zaXRpb24uaG9yaXpvbnRhbCA9PT0gJ2xlZnQnO1xuXG4gICAgbGV0IG9mZnNldCA9IDA7XG4gICAgaWYgKHRoaXMuYXJyb3cgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5nZXRIb3Jpem9udGFsQXJyb3dPZmZzZXQoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYXJyb3cgJiYgIWlzTGVmdCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuZ2V0SG9yaXpvbnRhbEFycm93T2Zmc2V0KCk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0hvcml6b250YWwpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5sZWZ0ICsgb2Zmc2V0O1xuICAgIH1cbiAgICBpZiAoIXRoaXMub3ZlcmxheXNUYXJnZXQgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGg7XG4gICAgfSBlbHNlIGlmICghdGhpcy5vdmVybGF5c1RhcmdldCAmJiAhaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYXJyb3cgJiYgaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5hcnJvd0hlaWdodDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYXJyb3cgJiYgIWlzTGVmdCkge1xuICAgICAgb2Zmc2V0IC09IHRoaXMuYXJyb3dIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5sZWZ0ICsgb2Zmc2V0O1xuICB9XG59XG4iXX0=